{% extends "ecologica/index.html" %}
{% load i18n admin_static %}

{% block title %}Producción Ecológica|Expediente|{{expediente.CodOperador}}{% endblock %}

{% block extrastyle %}

<style type="text/css">
	  .css-form input.ng-invalid.ng-touched {
		background-color: #FA787E;
	  }

	  .css-form input.ng-valid.ng-touched {
		background-color: #78FA89;
	  }
	  .css-form select.ng-invalid.ng-touched {
		background-color: #FA787E;
	  }

	  .css-form select.ng-valid.ng-touched {
		background-color: #78FA89;
	  }
</style>

{% endblock %}
{% block extrascripts %}
<script src="{% static 'js/Modulos/Expediente.js' %}"></script>
{% endblock %}



{% load i18n %}

{% block breadcrumbs %}
			<div class="row panel panel-default">
			<div class="panel-heading">
			  <div class="row ">
			  <div class="container-fluid">
				<div class="navbar-header">
					<ul class="breadcrumb">
					{% if tipoUs == 'A' %}<li><a id="breadmio" href="{% url 'ecologica:index' %}">Expedientes</a></li>{% endif %}
					{% if tipoUs != 'A' %}
					  <li><a id="breadmio" href="{% url 'ecologica:index' %}">Dashboard</a></li>
					   <li><a id="breadmio" href="{% url 'ecologica:clientes' %}">Clientes</a></li>
						<li><a id="breadmio" href="{% url 'ecologica:cliente' cliente.id %}">{{cliente.nifcif}}</a></li>
					{% endif %}
					  <li class="active"><strong>{{expediente.CodOperador}}</strong></li>
					</ul>
				</div>
				</div>
			</div>
			</div>
			</div>

{% endblock %}


{% block content %}
	<div ng-app="Expediente" class="row">

	<section ng-controller="Expediente" ng-init="inicializaExpediente('{{expediente.id}}','{{expediente.tipoAgricultura}}','{{auditor.id}}')">
		<div class="panel panel-info">
			<div class="panel-heading">
				<div class="panel panel-primary">
					<div class="panel-heading">
						<h4>Expediente: {{expediente.CodOperador}} | {{cliente.Nombre}} {{cliente.Apellido1}} {{cliente.Apellido2}} | {{expediente.Fecha_aecologica}}</h4>
					</div>
				</div>
				<ul class="nav nav-pills" role="tablist">
				  <li role="presentation" class="active"><a href="#Exp" aria-controls="Exp" role="tab" data-toggle="tab">Expediente</a></li>
				  {% if creaContactos == 'SI' or consultaContactos == 'SI' %}<li role="presentation"><a href="#Contactos" aria-controls="Contactos" role="tab" data-toggle="tab">Contactos</a></li>{% endif %}
				  {% if consultaInterlocutores == 'SI' or creaInterlocutores == 'SI'%}<li role="presentation"><a href="#Interlocutores" aria-controls="Interlocutores" role="tab" data-toggle="tab">Interlocutores</a></li>{% endif %}
				  {% if consultaparcela == 'SI' or creaparcela == 'SI' %}
				  {% if expediente.tipoAgricultura == 'AE' or expediente.tipoAgricultura == 'GA'%}
				  <li role="presentation"><a href="#Parcelas" aria-controls="Parcelas" role="tab" data-toggle="tab">Parcelas</a></li>
				  {% else %}
				  <li role="presentation"><a href="#Parcelas" aria-controls="Parcelas" role="tab" data-toggle="tab">Instalaciones</a></li>
				  {% endif %}
				  {% endif %}
				  {% if consultasRealizadas == 'SI' or tipoUs == 'A' %}<li role="presentation"><a href="#Visitas" aria-controls="Visitas" role="tab" data-toggle="tab">Visitas</a></li>{% endif %}
				  {% if consultaRiesgos == 'SI' or creaRiesgos == 'SI' or modificaRiesgos == 'SI' %}<li role="presentation"><a href="#Riesgos" aria-controls="Riesgos" role="tab" data-toggle="tab">Evaluación de Riesgos</a></li>{% endif %}
				  {% if creaFactura == 'SI' or consultaFacturacion == 'SI'%}<li role="presentation"><a href="#Facturacion" aria-controls="Facturacion" role="tab" data-toggle="tab">Facturación</a></li>{% endif %}
				</ul>
			</div>
			
			<div class="panel-body tab-content">
				<div role="tabpanel" class="tab-pane active" id="Exp">
				
						<div class="panel panel-info">
							<div class="panel-heading">
								Expediente: {{expediente.CodOperador}}
							</div>
							<div class="panel-body">
								
								<div class="col-lg-4">
									<div class="form-group">
										<div><label>Nombre:</label>	{{cliente.Nombre}} {{cliente.Apellido1}} {{cliente.Apellido2}}</div>
									</div>
								</div>
								<div class="col-lg-2">
									<div class="form-group">
										
										<div><label>{{tipoID}}:</label>	{{cliente.nifcif}}</div>
									</div>
								</div>
								<div class="col-lg-2">
									<div class="form-group">
										
										<div><label>Género:</label>	{{genero}}</div>
									</div>
								</div>
								
								<div class="col-lg-4">
									<div class="form-group">
										<div><label>Técnico Responsable:</label> {{expediente.responsable}}</div>
									</div>
								</div>
								
								<div class="col-lg-12">
									<div class="form-group">
										
										<div><label>Forma Jurídica:</label>	{{expediente.F_juridica}}</div>
									</div>
								</div>
						
							{% if expediente.CodSipea %} 
								<div class="col-lg-3">
									<div class="form-group">
										<div><label>Código en Sipea:</label> {{expediente.CodSipea}}</div>
									</div>
								</div>
							{% endif %}
							
							<div class="col-lg-2">
								<div class="form-group">
									<div><label>Teléfono:</label> {{cliente.Telefono1}}</div>
								</div>
							</div>
							
							{% if cliente.Telefono2  %} 
								<div class="col-lg-3">
									<div class="form-group">
										<div><label>Teléfono2:</label> {{cliente.Telefono2}}</div>
									</div>
								</div>
							{% endif %}
							
							{% if cliente.Fax %} 
								<div class="col-lg-4">
									<div class="form-group">
										<div><label>Fax:</label> {{cliente.Fax}}</div>
									</div>
								</div>
							{% endif %}
							
							{% if cliente.Email %} 
								<div class="col-lg-4">
									<div class="form-group">
										<div><label>E-mail:</label> {{cliente.Email }}</div>
									</div>
								</div>
							{% endif %}
							
							{% if cliente.Web %} 
								<div class="col-lg-8">
									<div class="form-group">
										<div><label>Web:</label><a href="{{cliente.Web}}" target="_blank"> {{cliente.Web}}</a></div>
									</div>
								</div>
							{% endif %}
							
							<div class="col-lg-12">
								<div class="form-group">
									<div><label>Domicilio:</label> {{cliente.Domicilio}}</div>
								</div>
							</div>
							
							<div class="col-lg-4">
								<div class="form-group">
									<div><label>Población:</label> {{cliente.Municipio}} ({{cliente.Provincia}})</div>
								</div>
							</div>
							
							<div class="col-lg-2">
								<div class="form-group">
									<div><label>CP:</label> {{cliente.CP}}</div>
								</div>
							</div>
							
							<div class="col-lg-4">
								<div class="form-group">
									<div><label>Recepción de la solicitud:</label> {{expediente.Fecha_recepcion}}</div>
								</div>
							</div>
							
							<div class="col-lg-4">
								<div class="form-group">
									<div><label>Inscripción en A.ecológica:</label> {{expediente.Fecha_aecologica}}</div>
								</div>
							</div>
							
							{% if estado %}
							<div class="col-lg-6">
								<div class="form-group">
									<div><label>Estado:</label><span class="label label-success">{{expediente.Estado}}</span></div>
								</div>
							</div>
							{% else %}
							<div class="col-lg-6">
								<div class="form-group">
									<div><label>Estado:</label><span class="label label-danger">{{expediente.Estado}}</span></div>
									<p class="text-danger"><label>&nbsp;&nbsp;&nbsp;Fecha de baja:</label>{{expediente.F_baja}}</p>
								</div>
							</div>
							{% endif %}
							{% if actividad %}
							<div class="col-lg-6">
								<div class="form-group">
									<div><label>Actividad:</label><span class="label label-success">{{expediente.con_actividad}}</span></div>
								</div>
							</div>
							{% else %}
							<div class="col-lg-6">
								<div class="form-group">
									<div><label>Actividad:</label><span class="label label-danger">{{expediente.con_actividad}}</span></div>
									<p class="text-danger"><label>&nbsp;&nbsp;&nbsp;Fecha de cese de actividad:</label>{{expediente.F_cese_activ}}</p>
								</div>
							</div>

							{% endif %}
							<div class="col-lg-6">
								<div class="form-group">
									<div><label>Producción en Paralelo:</label> {% if expediente.indProdParalela == 'NP' %}Dato desconocido{% else %}{{expediente.indProdParalela}}{% endif %}</div>
								</div>
							</div>
							{% if expediente.vigente == 'SI' %}
							<div class="col-lg-4">
								<div class="form-group">
									<div class="text-success"><label>Vigencia:</label> {{expediente.F_iniciovigencia}} / {{expediente.F_finalvigencia}}</div>
								</div>
							</div>
							<div class="col-lg-4">
								<div class="form-group">
									<div class="text-success"><label>Código del certificado:</label> {{codigo}}</div>
								</div>
							</div>
							{% elif expediente.vigente == 'NO' and expediente.haestadovigente = 'SI' %}
							<div class="col-lg-6">
								<div class="form-group">
									<span class="text-danger"><label>Última vigencia del certificado:</label> {{expediente.F_iniciovigencia}} / {{expediente.F_finalvigencia}}</span>
								</div>
							</div>
							{% else %}
							<div class="col-lg-4">
								<div class="form-group">
									<span class="text-danger"><label>No está certificado</label></span>
								</div>
							</div>
							{% endif %}
							
							
							
							
							{% if expediente.aso_ag == 'SI' %}
							<div class="col-lg-12">
								<div class="form-group">
									<div><label>Está asociado a la ASOCIACIÓN AGRARIA:</label> {{expediente.asociacion_agraria}}</div>
								</div>
							</div>
							{% endif %}
							{% if expediente.s_cop == 'SI'%}
							<div class="col-lg-12">
							<div class="col-lg-6">
								<div class="form-group">
									<div class="text-primary"><label>Está asociado a la cooperativa:</label> {{expediente.cooperativa}}</div>
								</div>
							</div>
							{% if expediente.info_contac1 %}
							<div class="col-lg-6">
								<div class="form-group">
									<div class="text-primary"><label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Persona de contacto:</label> {{expediente.info_contac1}}</div>
								</div>
							</div>
							{% endif %}
							</div>
							{% endif %}
							{% if expediente.com_ind == 'SI' %}
							<div class="col-lg-12">
							<div class="col-lg-6">
								<div class="form-group">
									<div class="text-warning"><label>Comercializan a través de la industria:</label> {{expediente.industria}}</div>
								</div>
							</div>
							{% if expediente.info_contac2 %}
							<div class="col-lg-6">
								<div class="form-group">
									<div class="text-warning"><label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Persona de contacto:</label> {{expediente.info_contac2}}</p></div>
								</div>
							</div>
							{% endif %}
							</div>
							{% endif %}
							{% if expediente.entidadPac %}
							<div class="col-lg-12">
							<div class="col-lg-6">
								<div class="form-group">
									<div class="text-success"><label>Entidad que le gestiona la PAC:</label> {{expediente.entidadPac}}</div>
								</div>
							</div>
							{% if expediente.info_contac3 %}
							<div class="col-lg-6">
								<div class="form-group">
									<div class="text-success"><label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Persona de contacto:</label> {{expediente.info_contac3}}</div>
								</div>
							</div>
							{% endif %}
							</div>
							{% endif %}
						
						</div> 

					</div>
					{% if modificaExpediente == 'SI' %}
					<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#modificaExp" aria-expanded="false" aria-controls="modificaExp">
					  Modificar Expediente
					</button>
					{% endif %}
					{% if generaCertificado == 'SI' and expediente.vigente == 'SI'%}
					<button type="button" class="btn btn-default pull-right" onclick="location.href='/expedientes/{{expediente.id}}/generaCertificado'"><i class="fa fa-file-pdf-o"></i> Generar Certificado</button>
					{% endif %}
					<div class="collapse" id="modificaExp">
						<div class="panel panel-info">
							<div class="panel-heading">
								Modificar Expediente
							</div>
							<div class="panel-body">
								<div class="row">
									<form id="formularioExpediente"class="css-form" name="ExpedienteForm" role="form" action="." method="POST">{% csrf_token %}
										<div class="col-lg-3">
											<div class="form-group">
												<label for="disabledSelect">Código Expediente</label>
												<input id="codExp" class="form-control" ng-model="codExp">
												<p class="help-block">Este código no debe modificarse si ya se ha registrado en SIPEA</p>
											</div>
										</div>
										<div class="col-lg-2">
											<div class="form-group">
												<label for="disabledSelect">Código en SIPEA</label>
												<input id="codSipea" class="form-control" ng-model="codSipea">
											</div>
										</div>
										<div class="col-lg-3">
											<div class="form-group">
												<label>Técnico Responsable*</label>
												<select id="responsable" class="form-control" name="responsable">
													<option value="{{responsableExp.id}}">{{responsableExp}}</option>
													{% for responsable in responsables %}
													<option value="{{responsable.id}}">{{responsable}}</option>
													{% endfor %}
												</select>
											</div>
										</div>
										<div class="col-lg-3">
											<div class="form-group">
												<label>Forma Jurídica*</label>
												<select id="fj" class="form-control" name="fj" ng-model="fj" required>
													{% for forma in formaJ %}
													<option value="{{forma.id}}">{{forma.Forma_Juridica}}</option>
													{% endfor %}
												</select>
												<div class="error-container" ng-show="ExpedienteForm.fj.$dirty && ExpedienteForm.fj.$invalid">
													<small class="error text-danger" ng-show="ExpedienteForm.fj.$error.required">La forma jurídica es requerida</small>
												</div>
											</div>
										</div>
										<div class="col-lg-12">
										</div>
										<div class="col-lg-2">
											<div class="form-group">
												<label>Estado</label>
												<select id="estado" class="form-control" name="estado" ng-model="est" required>
													<option value="ALTA">ALTA</option>
													<option value="BAJA">BAJA</option>
												</select>
											</div>
										</div>
										<div class="col-lg-3 has-success" ng-show="est=='BAJA'">
											<div class="form-group">
												<label class="control-label" for="inputDanger">Fecha de baja</label>
												<input id="fbaja" type="date" class="form-control" name="fbaja" ng-model="fbaja" required>
											</div>
										</div>
										<div class="col-lg-2">
											<div class="form-group">
												<label>Con actividad</label>
												<select id="actividad" class="form-control" name="actividad" ng-model="act" required>
													<option value="SI">SI</option>
													<option value="NO">NO</option>
												</select>
											</div>
										</div>
										<div class="col-lg-3">
											<div class="form-group">
												<label>Producción en Paralelo*</label>
												<select id="pp" class="form-control" name="pp" ng-model="pp" title="Indicador de que el operador presenta producción convencional en paralelo a la ecológica en agricultura" required>
													<option value="SI">Si</option>
													<option value="NO">No</option>
													<option value="NP">Dato desconocido</option>
												</select>
											</div>
										</div>
										<div class="col-lg-3 has-danger" ng-show="act=='NO'">
											<div class="form-group">
												<label>Fecha de cese de actividad</label>
												<input id="fcact" type="date" class="form-control" name="fcact" ng-model="fcact" required>
											</div>
										</div>
										<div class="col-lg-12">
										</div>
										<div class="col-lg-3">
											<div class="form-group">
												<label>Fecha de recepción*</label>
												<input id="frecp" type="date" class="form-control" name="frecp" ng-model="frecp" required>
												<div class="error-container" ng-show="ExpedienteForm.frecp.$dirty && ExpedienteForm.frecp.$invalid">
													<small class="error text-danger" ng-show="ExpedienteForm.frecp.$error.required">La fecha de recepción es requerida</small>
												</div>
											</div>
										</div>
										<div class="col-lg-3">
											<div class="form-group">
												<label>Fecha de inscripción*</label>
												<input id="fins" type="date" class="form-control" name="fins" ng-model="finscrip" required>
												<div class="error-container" ng-show="ExpedienteForm.fins.$dirty && ExpedienteForm.fins.$invalid">
													<small class="error text-danger" ng-show="ExpedienteForm.fins.$error.required">La fecha de inscripción es requerida</small>
												</div>
											</div>
										</div>
										<div class="col-lg-3">
											<div class="form-group">
												<label>Nº Documento Vigencia</label>
												<input id="idDoc" class="form-control" ng-model="idDoc">
											</div>
										</div>
										
										
										<div class="col-lg-12">
											<div class="form-group">
												
											</div>
										</div>

										<div class="col-lg-12">
											<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
												<div class="panel panel-warning">
													<div class="panel-heading" role="tab" id="headingOne">
														<h4 class="panel-title">
															<a data-toggle="collapse" href="" data-target="#infoAdicional" aria-expanded="false" aria-controls="infoAdicional">
																<i class="fa fa-plus-circle"></i> Información adicional
															</a>
														</h4>
													</div>
													<div class="collapse" id="infoAdicional">
														<div class="panel-body">
															<div class="col-lg-12">
																<div class="form-group">
																	<h5>¿Está asociado a alguna <strong>ASOCIACIÓN AGRARIA?</strong>
																	<label class="text-success">SI<input id="asag1" type="radio" ng-model="asag" value="SI"></label>
																	&nbsp;&nbsp;&nbsp;
																	<label class="text-danger">NO<input id="asag2" type="radio" ng-model="asag" value="NO"></label></h5>
																</div>
															</div>
															<div class="col-lg-12" ng-show="asag=='SI'">
																<div class="form-group">
																	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
																	<label>Indicar<input id="asoc" class="form-control" ng-model="asoc"></label>

																</div>
															</div>
																
															
															<div class="col-lg-12">
																<div class="form-group">
																	<h5>¿Es socio de alguna cooperativa?</strong>
																	<label class="text-success">SI<input id="coop1" type="radio" ng-model="coop" value="SI"></label>
																	&nbsp;&nbsp;&nbsp;
																	<label class="text-danger">NO<input id="coop2" type="radio" ng-model="coop" value="NO"></label></h5>
																</div>
															</div>
															<div class="col-lg-12" ng-show="coop=='SI'">
																<div class="form-group">
																	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
																	<label>Indicar<input id="cooperativa" class="form-control" ng-model="cooperativa"></label>
																	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
																	<label>Persona de contacto (Teléfono)<input id="pc1" class="form-control" ng-model="pc1"></label>
																</div>
																
															</div>
															<div class="col-lg-12">
																<div class="form-group">
																	<h5>¿Comercializan a través de una industria?</strong>
																	<label class="text-success">SI<input id="ind1" type="radio" ng-model="ind" value="SI"></label>
																	&nbsp;&nbsp;&nbsp;
																	<label class="text-danger">NO<input id="ind2" type="radio" ng-model="ind" value="NO"></label></h5>
																</div>
															</div>
															<div class="col-lg-12" ng-show="ind=='SI'">
																<div class="form-group">
																	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
																	<label>Indicar<input id="industria" class="form-control" ng-model="industria"></label>
																	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
																	<label>Persona de contacto (Teléfono)<input id="pc2" class="form-control" ng-model="pc2"></label>
																</div>
																
															</div>
															<div class="col-lg-12">
																<div class="form-group">
																	<h5>¿Entidad que le gestiona la PAC?</strong>
																</div>
															</div>
															<div class="col-lg-12">
																<div class="form-group">
																	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
																	<label>Indicar<input class="form-control" id="PAC" ng-model="PAC"></label>
																	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
																	<label>Persona de contacto (Teléfono)<input class="form-control" id="pc3" ng-model="pc3"></label>
																</div>
																
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>

									</form>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-warning" ng-click="guardar('{{expediente.id}}')"><i class="fa fa-save"></i> Guardar cambios</button>
								
							</div>
						</div>	
					</div>
					
					
						
			</div>
			
			<div role="tabpanel" class="tab-pane" id="Contactos">
				
				<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
					{% if creaContactos == 'SI' %}
					<div class="panel panel-info ">
						<div class="panel-heading">
							<h4 class="panel-title">
								<a href="" ng-click="agregaOperador('{{cliente.nifcif}}','{{cliente.Nombre}}','{{cliente.Apellido1}}','{{cliente.Apellido2}}','{{cliente.Genero}}','{{cliente.Telefono1}}','{{cliente.Telefono2}}','{{cliente.Fax}}','{{cliente.Email}}','{{cliente.Provincia.id}}','{{cliente.Municipio.id}}','{{cliente.Domicilio}}','{{cliente.CP}}','{{expediente.id}}')">
									<i class="fa fa-plus-circle"></i> Agregar operador como contacto
								</a>
							</h4>
						</div>
					</div>
					{% endif %}
					<div class="panel panel-info">
						<div class="panel-heading" role="tab" id="headingOne">
							<h4 id="collapseForm" class="panel-title">
								{% if creaContactos == 'SI' %}
								<div ng-hide="modificaContacto">
									<a data-parent="#accordion" href="" data-target="#nuevoContacto" data-toggle="collapse" aria-expanded="false" aria-controls="nuevoContacto">
										<i class="fa fa-plus-circle"></i> Nuevo contacto
									</a>
								</div>
								{% endif %}
								<div ng-show="modificaContacto">
									<a data-parent="#accordion" href="" data-target="#nuevoContacto" data-toggle="collapse" aria-expanded="true" aria-controls="nuevoContacto">
										<i class="fa fa-plus-circle"></i> Modificar contacto
									</a>
								</div>
							</h4>
						</div>
						<div class="collapse" id="nuevoContacto">
							<div class="panel-body">
								<div class="row">
							<form id="formularioContacto"class="css-form" name="formularioContacto" role="form" action="." method="POST">{% csrf_token %}
								<div class="col-lg-2">
									<div class="form-group">
										<label>NIF*</label>
										<input class="form-control" name="nif" ng-model="contacto.nif" required ng-minlength=9 ng-maxlength=9 nifcif>
									</div>
								</div>

								
								<div class="col-lg-4">
									<div class="form-group">
										<label>Nombre*</label>
										<input class="form-control" name="nombre" ng-model="contacto.nombre" required ng-minlength=3>
									</div>
								</div>
								
								<div class="col-lg-3">
									<div class="form-group">
										<label>Apellido1</label>
										<input class="form-control" name="apellido1" ng-model="contacto.apellido1"ng-minlength=3>
									</div>
								</div>
								<div class="col-lg-3">
									<div class="form-group">
										<label>Apellido2</label>
										<input class="form-control" name="apellido2"ng-model="contacto.apellido2">
									</div>
								</div>
								<div class="col-lg-12">
									</br>
									<div class="form-group">
										<label>Hombre <input type="radio" name="gen" ng-model="contacto.gen" value="H"></label>
											&nbsp;&nbsp;&nbsp;
										<label>Mujer <input type="radio" name="gen "ng-model="contacto.gen" value="M"></label>
									</div>
								</div>
									
								<div class="col-lg-4" ng-show="modificaContacto2 || !modificaContacto">
									<div class="form-group">
										<label>Provincia*</label>
											<select id ="provinciaSeleccionada"class="form-control" name="provincia" ng-model="provinciaSeleccionada" required>
												<option  selected="true" style="display:none;" value="">Selecciona Provincia</option>
												{% for provincia in provincias %}
													<option value="{{provincia.id}}">{{provincia.CodProvincia}} - {{provincia.Provincia}}</option>
												{% endfor %}
											</select>
									</div>
								</div>
							
								<div class="col-lg-4" ng-hide="modificaContacto2 || !modificaContacto">
									<div class="form-group">
										<label>Provincia*</label>
										<div>[[provincia]]</div>
									</div>
								</div>
																			
								<div class="col-lg-5" ng-show="modificaContacto2 || !modificaContacto">
									<div class="form-group">
										<label>Municipio*</label>
										<select id="municipioSeleccionado" class="form-control" name="municipio" ng-model="municipioSeleccionado" required>
											<option  selected="true" style="display:none;" value="">Selecciona Municipio</option>
											<option ng-repeat="municipio in municipios  | filter: {idProvincia: provinciaSeleccionada}" value="[[municipio.id]]">[[municipio.CodMunicipio]] - [[municipio.Municipio]]</option>
										</select>
									</div>
								</div>
								
								<div class="col-lg-5" ng-hide="modificaContacto2 || !modificaContacto">
									<div class="form-group">
										<label>Municipio*</label>
										<div>[[municipio]] <button type="button" class="btn btn-info pull-right" ng-click="modificaContacto2 = 'true'"><i class="fa fa-save"></i> Modificar</button></div>
									</div>
								</div>
								
								<div class="col-lg-6">
									<div class="form-group">
										<label>Domicilio*</label>
										<input class="form-control" name="domicilio" ng-model="contacto.domicilio" required ng-minlength=3>
									</div>
								</div>
								
								<div class="col-lg-4">
									<div class="form-group">
										<label>CP*</label>
										<input class="form-control" name="cp" ng-model="contacto.cp" required ng-minlength=5 ng-maxlength=5>
									</div>
								</div>
								
								<div class="col-lg-3">
									<div class="form-group">
										<label>Teléfono1*</label>
										<input class="form-control" name="telefono1" ng-model="contacto.tel1" required pattern="^[9|8|7|6]\d{8}$">
									</div>
								</div>
								<div class="col-lg-3">
									<div class="form-group">
										<label>Teléfono2</label>
										<input class="form-control" name="telefono2" ng-model="contacto.tel2" pattern="^[9|8|7|6]\d{8}$">
									</div>
								</div>
								<div class="col-lg-3">
									<div class="form-group">
										<label>Fax</label>
										<input class="form-control" name="fax" ng-model="contacto.fax"pattern="^[9|8|7|6]\d{8}$">
									</div>
								</div>
								<div class="col-lg-4">
									<div class="form-group">
										<label>E-mail</label>
										<input type="email" name="email" class="form-control"placeholder="Ej. persona@empresa.com" ng-model="contacto.email">
									</div>
								</div>
							</form>
						</div>
							</div>
							<div class="modal-footer">
								<div class="pull-left"><button type="button" class="btn btn-default" ng-click="limpiarContacto()"><i class="fa fa-eraser"></i> Limpiar</button></div>
								<button type="button" class="btn btn-warning pull-right" ng-click="guardarContacto('{{expediente.id}}')" ng-hide="modificaContacto"><i class="fa fa-save"></i> Guardar</button>
								<button type="button" class="btn btn-info pull-right" ng-click="modificaContact2('{{expediente.id}}')" ng-show="modificaContacto"><i class="fa fa-save"></i> Modificar</button>
								<button type="button" class="btn btn-danger pull-right" ng-click="cancelarCont()" ng-show="modificaContacto"><i class="fa fa-times-circle"></i> Cancelar</button>
							</div>
						</div>
					</div>
					
				</div>
					{% if consultaContactos == 'SI' %}
					<div class="panel panel-info">
						<div class="panel-heading">
							<strong>Contactos</strong>
							<div class="pull-right"><input type="text" class="form-control" placeholder="Búsqueda..." ng-model="ngContacto"></div>
						</div>
						<!-- /.panel-heading -->
						<div class="panel-body">
							
							<div class="table-responsive">
								
								<table class="table table-striped table-bordered table-hover">
									
									<thead>
										<tr>
											<th width="30"></th>
											<th>Nombre y Apellidos</th>
											<th>NIF</th>
											<th>Teléfono</th>
											<th>Localidad</th>
									
										</tr>
									</thead>
									<tbody>
										
										<tr ng-repeat="contacto in contactos|  filter :ngContacto">
											<td>{% if modificaContactos == 'SI' %}<a href="" ng-click="editaContacto(contacto.id)"><i class="fa fa-edit text-info"></i>{% endif %}</td>
											<td>[[contacto.Nombre]] [[contacto.Apellido1]] [[contacto.Apellido2]]</td>
											<td>[[contacto.nif]]</td>
											<td>[[contacto.Telefono1]]</td>
											<td>[[contacto.mun]] ([[contacto.prov]])</td>
											<td>
												<a href="" ng-click="eliminarContacto(contacto.id)"><i class="fa fa-trash-o text-danger"></i></a>
											</td>
										</tr>
											
									</tbody>
									
								</table>
							</div>

						</div>
						
					</div>
					{% endif %}
		
			</div>
			<div role="tabpanel" class="tab-pane" id="Interlocutores">
				
				<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
				{% if creaInterlocutores == 'SI' %}
				<div class="panel panel-info">
					<div class="panel-heading" role="tab" id="headingOne">
						<h4 class="panel-title">
							
							<div ng-hide="modificaInterlocutor">
								<a data-toggle="collapse" href="" data-target="#nuevoInterlocutor" aria-expanded="false" aria-controls="nuevoInterlocutor">
									<i class="fa fa-plus-circle"></i> Nuevo interlocutor
								</a>
							</div>
							
							<div ng-show="modificaInterlocutor">
								<a data-toggle="collapse" href="" data-target="#nuevoInterlocutor" aria-expanded="true" aria-controls="nuevoInterlocutor">
									<i class="fa fa-plus-circle"></i> Modificar interlocutor
								</a>
							</div>
						</h4>
					</div>
					<div class="collapse" id="nuevoInterlocutor">
						<div class="panel-body">
							<div class="row">
						<form id="formularioInterlocutor1"class="css-form" name="formularioInterlocutor1" role="form" action="." method="POST">{% csrf_token %}
							<div class="col-lg-2">
								<div class="form-group">
									<label>NIF*</label>
									<input class="form-control" name="nif" ng-model="inter.nif" required ng-minlength=9 ng-maxlength=9 nifcif>
								</div>
							</div>

							
							<div class="col-lg-4">
								<div class="form-group">
									<label>Nombre*</label>
									<input class="form-control" name="nombre" ng-model="inter.nombre" required ng-minlength=3>
								</div>
							</div>
							
							<div class="col-lg-3">
								<div class="form-group">
									<label>Teléfono1*</label>
									<input class="form-control" name="telefono1" ng-model="inter.tel2" required pattern="^[9|8|7|6]\d{8}$">
								</div>
							</div>
							<div class="col-lg-3">
								<div class="form-group">
									<label>Teléfono2</label>
									<input class="form-control" name="telefono2" ng-model="inter.tel1" pattern="^[9|8|7|6]\d{8}$">
								</div>
							</div>
							
							<div class="col-lg-4">
								<div class="form-group">
									<label>E-mail</label>
									<input type="email" name="email" class="form-control"placeholder="Ej. persona@empresa.com" ng-model="inter.email">
								</div>
							</div>
							
							<div class="col-lg-12">
								<div class="form-group">
									<h5>¿Está autorizado para atender la visita?
									<label class="text-success">SI<input id="atvis" type="radio" ng-model="atvis" value="SI"></label>
													&nbsp;&nbsp;&nbsp;
									<label class="text-danger">NO<input type="radio" ng-model="atvis" value="NO"></label></h5>
								</div>
							</div>
							<div class="col-lg-12">
								<div class="form-group">
									<h5>¿Está autorizado para firmar la visita?
									<label class="text-success">SI<input id="firvis" type="radio" ng-model="firvis" value="SI"></label>
													&nbsp;&nbsp;&nbsp;
									<label class="text-danger">NO<input type="radio" ng-model="firvis" value="NO"></label></h5>
								</div>
							</div>
						</form>
					</div>
						</div>
						<div class="modal-footer">
							<div class="pull-left"><button type="button" class="btn btn-default" ng-click="limpiarInterloc3()"><i class="fa fa-eraser"></i> Limpiar</button></div>
							<button type="button" class="btn btn-info pull-right" ng-click="guardarInterloc3('{{expediente.id}}')" ng-hide="modificaInterlocutor"><i class="fa fa-save"></i> Guardar</button>
							<button type="button" class="btn btn-info pull-right" ng-click="modificaInterlocut('{{expediente.id}}')" ng-show="modificaInterlocutor"><i class="fa fa-save"></i> Modificar</button>
							<button type="button" class="btn btn-danger pull-right" ng-click="cancelar()" ng-show="modificaInterlocutor"><i class="fa fa-times-circle"></i> Cancelar</button>
						</div>
					</div>
				</div>
				
				<div class="panel panel-info">
					<div class="panel-heading" role="tab" id="headingOne">
						<h4 class="panel-title">
							<a data-toggle="collapse" href="" data-target="#nuevoInterlocutor2" aria-expanded="false" aria-controls="nuevoContacto">
								<i class="fa fa-plus-circle"></i> Usar contacto existente
							</a>
						</h4>
					</div>
					<div class="collapse" id="nuevoInterlocutor2">
						<div class="panel-body">
							<div class="row">
						<form id="formularioInterlocutor2"class="css-form" name="formularioIntyerlocutor2" role="form" action="." method="POST">{% csrf_token %}
							
							<div class="col-lg-4">
								<div class="form-group">
									<label>Selecciona Contacto</label>
									<select id="contactoInterlocutor" class="form-control" name="contint" ng-model="contint" required>
										<option ng-repeat="contacto in contactos" value="[[contacto.id]]">[[contacto.Nombre]] [[contacto.Apellido1]] [[contacto.Apellido2]]</option>
									</select>
								</div>
							</div>
							
							<div class="col-lg-12">
								<div class="form-group">
									<h5>¿Está autorizado para atender la visita?
									<label class="text-success">SI<input id="atvis2" type="radio" ng-model="atvis2" value="SI"></label>
													&nbsp;&nbsp;&nbsp;
									<label class="text-danger">NO<input  type="radio" ng-model="atvis2" value="NO"></label></h5>
								</div>
							</div>
							<div class="col-lg-12">
								<div class="form-group">
									<h5>¿Está autorizado para firmar la visita?
									<label class="text-success">SI<input id="firvis2" type="radio" ng-model="firvis2" value="SI"></label>
													&nbsp;&nbsp;&nbsp;
									<label class="text-danger">NO<input type="radio" ng-model="firvis2" value="NO"></label></h5>
								</div>
							</div>
						</form>
					</div>
						</div>
						<div class="modal-footer">
							<div class="pull-left"><button type="button" class="btn btn-default" ng-click="limpiarInterloc2()"><i class="fa fa-eraser"></i> Limpiar</button></div>
							<button type="button" class="btn btn-info pull-right" ng-hide ="hayContacto(contactos.length)" disabled><i class="fa fa-save"></i> Guardar</button>
							<button type="button" class="btn btn-info pull-right" ng-show ="hayContacto(contactos.length)" ng-click="guardarInterloc4('{{expediente.id}}')" ><i class="fa fa-save"></i> Guardar</button>
						</div>
					</div>
				</div>
				</br>
				{% endif %}
				{% if consultaInterlocutores == 'SI' %}
				<div class="panel panel-info">
				<div class="panel-heading">
					<strong>Interlocutores</strong>
					<div class="pull-right"><input type="text" class="form-control" placeholder="Búsqueda..." ng-model="ngInter"></div>
				</div>
				<!-- /.panel-heading -->
				<div class="panel-body">
				
				
					<div class="table-responsive">

						<table class="table table-striped table-bordered table-hover">
							
							<thead>
								<tr>
									<th width="30"></th>
									<th>Nombre</th>
									<th>NIF</th>
									<th>Teléfono</th>
									<th>Atiende Visita</th>
									<th>Firma Visita</th>
							
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="interlocutor in interlocutores|  filter :ngInter">
									<td>{% if modificaInterlocutores == 'SI' %}<a href="" ng-click="editaInterlocutor(interlocutor.id)"><i class="fa fa-edit text-info"></i>{% endif %}</td>
									<td>[[interlocutor.Nombre]]</td>
									<td>[[interlocutor.nif]]</td>
									<td>[[interlocutor.TelefonoMovil]]</td>
									<td>[[interlocutor.AtiendeVisita]]</td>
									<td>[[interlocutor.FirmaVisita]]</td>
									<td>
										{% if modificaInterlocutores == 'SI' %}<a href="" ng-click="eliminarInterlocutor(interlocutor.id)"><i class="fa fa-trash-o text-danger"></i></a>{% endif %}
									</td>
								</tr>
		
							</tbody>
						</table>
					</div>
					
				</div>

			</div>
			{% endif %}
			</div>
			
			</div>
				
			<div role="tabpanel" class="tab-pane" id="Parcelas">
				<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
				{% if creaparcela == 'SI' %}
				<div class="panel panel-info">
					
					<div class="panel-heading" role="tab" id="headingOne">
						<h4 class="panel-title">
							{% if expediente.tipoAgricultura == 'AE' or expediente.tipoAgricultura == 'GA' %}
							<a data-toggle="collapse" href="" data-target="#nuevaParcela" aria-expanded="false" aria-controls="nuevaParcela">
								<i class="fa fa-plus-circle"></i> Nueva Parcela
							</a>
							{% else %}
							<a data-toggle="collapse" href="" data-target="#nuevaParcela" aria-expanded="false" aria-controls="nuevaParcela">
								<i class="fa fa-plus-circle"></i> Nueva Instalación
							</a>
							{% endif %}
						</h4>
					</div>
					
					<div class="collapse" id="nuevaParcela">
						<div class="panel-body">
							<div class="row">
						<form id="formularioParcela"class="css-form" name="formularioParcela" role="form" action="." method="POST">{% csrf_token %}
							
							<div class="col-lg-3">
								<div class="form-group">
									<label>Producción ecológica</label>
									<select id="eco" class="form-control" name="eco" ng-model="parcela.eco" required>
										<option value="SI">SI</option>
										<option value="NO">NO</option>
									</select>
								</div>
							</div>
							{% if expediente.tipoAgricultura == 'IN' %}
							<div class="col-lg-3">
								<div class="form-group">
									<label>¿Está inscrito en el RIA?</label>
									<select id="RIA" class="form-control" name="RIA" ng-model="RIA" required>
										<option value="SI">SI</option>
										<option value="NO">NO</option>
									</select>
								</div>
							</div>
						
							<div class="col-lg-3" ng-show="RIA == 'SI'">
								<div class="form-group">
									<label>Matrícula RIA*(xx/yyyyy)</label>
									<input id="matRIA" class="form-control" name="matRIA" ng-model="matRIA" ng-change="cambiaRIA()" required ng-maxlength=12 pattern="\d{2}/\d{5}">
								</div>
							</div>
							{% endif %}
							
							<div class="col-lg-12">
								<div class="form-group">

								</div>
							</div>
						
						
							<div class="col-lg-3">
								<div class="form-group">
									{% if expediente.tipoAgricultura == 'AE' or expediente.tipoAgricultura == 'GA'%}<label>Provincia*</label>
									{% else %}	<label ng-show="RIA == 'SI' || !RIA">Provincia</label>
												<label ng-show="RIA == 'NO'">Provincia*</label>
									{% endif %}
										<select id ="provSeleccionada"class="form-control" name="provincia" ng-model="provSelecionada" required>
											<option  selected="true" style="display:none;" value="">Selecciona Provincia</option>
											{% for provincia in provincias %}
												<option value="{{provincia.id}}">{{provincia.CodProvincia}} - {{provincia.Provincia}}</option>
											{% endfor %}
										</select>
								</div>
							</div>
							
							<div class="col-lg-4">
								<div class="form-group">
									{% if expediente.tipoAgricultura == 'AE' or expediente.tipoAgricultura == 'GA'%}<label>Municipio*</label>
									{% else %}	<label ng-show="RIA == 'SI' || !RIA">Municipio</label>
												<label ng-show="RIA == 'NO'">Municipio*</label>
									{% endif %}
									<select id="munSeleccionado" class="form-control" name="municipio" ng-model="munSeleccionado" required>
										<option  selected="true" style="display:none;" value="">Selecciona Municipio</option>
										<option ng-repeat="municipio in municipios  | filter: {idProvincia: provSelecionada}" value="[[municipio.id]]">[[municipio.CodMunicipio]] - [[municipio.Municipio]]</option>
									</select>
								</div>
							</div>
							
							<div class="col-lg-12">
								<div class="form-group">
								</div>
							</div>
							
						{% if expediente.tipoAgricultura == 'IN' %}
						<div class="col-lg-4">
							<div class="form-group">
								<label ng-show="RIA == 'NO'">Domicilio*</label>
								<label ng-show="RIA == 'SI' || !RIA">Domicilio</label>
								<input id="domicilio" class="form-control" name="domicilio" ng-model="domicilio">
							</div>
						</div>
						<div class="col-lg-2">
							<div class="form-group">
								<label ng-show="RIA == 'NO'">CP*</label>
								<label ng-show="RIA == 'SI' || !RIA">CP</label>
								<input id="CP" class="form-control" name="CP" ng-model="CP" ng-minlength=5 ng-maxlength=5>
							</div>
						</div>
						
						<div class="col-lg-2">
							<div class="form-group">
								<label ng-show="RIA == 'NO'">Coord. UTM X*</label>
								<label ng-show="RIA == 'SI' || !RIA">Coord. UTM X</label>
								<input id="utmx" class="form-control" name="utmx" ng-model="utmx">
							</div>
						</div>
						
						<div class="col-lg-2">
							<div class="form-group">
								<label ng-show="RIA == 'NO'">Coord. UTM Y*</label>
								<label ng-show="RIA == 'SI' || !RIA">Coord. UTM Y</label>
								<input id="utmy" class="form-control" name="utmy" ng-model="utmy">
							</div>
						</div>
						
						<div class="col-lg-12" ng-show="RIA == 'SI'">
							<div class="form-group">
							</div>
						</div>
						
						<div class="col-lg-2" ng-show="RIA == 'SI'">
							<div class="form-group">
								<label>Registro Sanitario*</label>
								<input id="regSan" class="form-control" name="regSan" ng-model="regSan" required ng-maxlength=13>
							</div>
						</div>
						
						<div class="col-lg-3">
							<div class="form-group">
								<label>Registro Embotelladora</label>
								<input id="regEmb" class="form-control" name="regEmb" ng-model="regEmb" ng-maxlength=10>
							</div>
						</div>
						{% endif %}
						{% if expediente.tipoAgricultura != 'IN' %}
							<div class="col-lg-2">
								<div class="form-group">
									<label>Polígono*</label>
									<input id="poli" class="form-control" name="poligono" ng-model="parcela.poligono" required ng-minlength=1 ng-maxlength=3>
								</div>
							</div>
							<div class="col-lg-3">
								<div class="form-group">
									<label>Parcela*</label>
									<input id="parce" class="form-control" name="parcela" ng-model="parcela.parcela" required ng-minlength=1 ng-maxlength=5>
								</div>
							</div>
							<div class="col-lg-3">
								<div class="form-group">
									<label>Recinto/s*</label>
									<input id="recin" class="form-control" name="recinto" ng-model="parcela.recinto" required ng-minlength=1 ng-maxlength=5>
								</div>
							</div>
							
							<div class="col-lg-4">
								<div class="form-group">
									<label>Superficie (ha)*</label>
									<input id="superficie" class="form-control" name="superficie" ng-model="parcela.superficie" required>
								</div>
							</div>
							{% endif %}
							<div class="col-lg-12">
								<div class="form-group">
									
								</div>
							</div>
							
							{% if expediente.tipoAgricultura == 'GA' %}
							<div class="col-lg-4">
								<div class="form-group">
									<label>Código REGA de la explotación*</label>
									<input id = "codigoExplotacion" class="form-control" name="codigoExplotacion" ng-model="codigoExplotacion" required ng-minlength=14 ng-maxlength=14 pattern="^ES\d{12}$" placeholder="ES123456789123">
								</div>
							</div>
						
							<div class="col-lg-3">
								<div class="form-group">
									<label>Grupo de cultivo*</label>
									<select id="grupoCultivo" class="form-control" name="grupoCultivo" ng-model="grupoCultivo" required>
										<option value="1">Dehesa</option>
										<option value="2">Pradera</option>
										<option value="3">Pasto</option>
										<option value="4">Pastizal</option>
									</select>
								</div>
							</div>
							
							<div class="col-lg-12">

							</div>
							<div class="col-lg-4">
								<div class="form-group">
									<label>Actividad Genérica*</label>
									<select id="ActGen2" class="form-control" name="actgen2" ng-model="ActGen2" required>
									{% for actividad2 in actgen2 %}
										<option value="{{actividad2}}">{{actividad2}}</option>
									{% endfor %}
									</select>
								</div>
							</div>
							
							<div class="col-lg-4">
								<div class="form-group">
									<label>Orientación Productiva*</label>
									<select id="productoGan" class="form-control" name="productoGan" ng-model="productoGan" required>
										<option ng-repeat="orientacion in orientaciones | filter: {Actividad: ActGen2}| orderBy:'Producto'" value="[[orientacion.CodProducto]]">[[orientacion.Producto]]</option>
									</select>
								</div>
							</div>
							
							<div class="col-lg-4">
								<div class="form-group">
									<label>Raza animal</label>
									<input id = "Raza" class="form-control" name="Raza" ng-model="Raza">
								</div>
							</div>
							
							<div class="col-lg-3">
								<div class="form-group">
									<label>Número de animales/colmenas</label>
									<input id="animales" class="form-control" name="animales" ng-model="animales">
								</div>
							</div>
							
							<div class="col-lg-3">
								<div class="form-group">
									<label>Número en el registro apícola</label>
									<input id="regApicola" class="form-control" name="regApicola" ng-model="regApicola">
								</div>
							</div>
							
							<div class="col-lg-3">
								<div class="form-group">
									<label>Número de registro de acuicultura</label>
									<input id="regAcuicola" class="form-control" name="regAcuicola" ng-model="regAcuicola">
								</div>
							</div>
							
							<div class="col-lg-3">
								<div class="form-group">
									<label>Tipo de estructura</label>
									<select id="tipoAcuicola" class="form-control" name="tipoAcuicola" ng-model="tipoAcuicola" required>
										<option value="0">-</option>
										<option value="1">Estanque</option>
										<option value="2">Estero</option>
										<option value="3">Jaula</option>
										<option value="4">Otra estructura fija</option>
										<option value="5">Otra estructura móvil</option>
									</select>
								</div>
							</div>
							
							<div class="col-lg-3">
								<div class="form-group">
									<label>Coordenada UTM X</label>
									<input id="UtmX" class="form-control" name="UtmX" ng-model="UtmX">
								</div>
							</div>
							
							<div class="col-lg-3">
								<div class="form-group">
									<label>Coordenada UTM Y</label>
									<input id="UtmY" class="form-control" name="UtmY" ng-model="UtmY">
								</div>
							</div>
							
							<div class="col-lg-4">
								<div class="form-group">
									<label>Volumen de producción estimado(Kg) > 0*</label>
									<input id="Produccion" class="form-control" name="Produccion" ng-model="Produccion">
								</div>
							</div>
							{% endif %}
							{% if expediente.tipoAgricultura == 'AE' %}
							<div class="col-lg-4">
								<div class="form-group">
									<label>Actividad Genérica*</label>
									<select id="ActGen" class="form-control" name="actgen" ng-model="ActGen" required>
									{% for actividad in actgen %}
										<option value="{{actividad}}">{{actividad}}</option>
									{% endfor %}
									</select>
								</div>
							</div>
							
							<div class="col-lg-4">
								<div class="form-group">
									<label>Cultivo*</label>
									<select id="cultivo" class="form-control" name="cultivo" ng-model="cultivo" required>
										<option ng-repeat="cultivo in cultivos | filter: {Actividad: ActGen}" value="[[cultivo.CodCultivo]]">[[cultivo.Cultivo]]</option>
									</select>
								</div>
							</div>
							
							<div class="col-lg-4">
								<div class="form-group">
									<label>Variedad</label>
									<select id ="variedad" class="form-control" name="variedad" ng-model="vari">
										<option ng-repeat="var in variedad | filter: {CodCultivo: cultivo}" value="[[var.id]]">[[var.Variedad]]</option>
									</select>
								</div>
							</div>
							{% endif %}
							{% if expediente.tipoAgricultura != 'IN' %}
							<div class="col-lg-3">
								<div class="form-group">
									<label>SR*</label>
									<select id="sr" class="form-control" name="sr" ng-model="sr" required>
										<option value="S">Secano</option>
										<option value="R">Regadío</option>
									</select>
								</div>
							</div>
							{% endif %}
						{% if expediente.tipoAgricultura == 'IN' %}
							<div class="col-lg-3">
							<div class="form-group">
								<label>Tipos de Procesado*</label>
								<ul class="list-group">
								  <li class="list-group-item"><input ng-model="Elaboracion" type="checkbox" value="E"> Elaboración</li>
								  <li class="list-group-item"><input ng-model="Envasado" type="checkbox" value="X"> Envasado</li>
								  <li class="list-group-item"><input ng-model="Comercializacion" type="checkbox" value="C"> Comercialización</li>
								  <li class="list-group-item"><input ng-model="Importacion" type="checkbox" value="I"> Importación</li>
								  <li class="list-group-item"><input ng-model="Exportacion" type="checkbox" value="P"> Exportación</li>
								</ul>
							</div>
						</div>
						
						<div class="col-lg-9">
							<div class="col-lg-9 col-lg-4">
							<div class="form-group">
								<label>Tipo Comercialización*</label>
								<select class="form-control" name="tipoCom" ng-model="tipoCom" required>
									<option value=1>Mayorista</option>
									<option value=2>Minorista</option>
								</select>	
							</div>
							</div>
							<div class="col-lg-9 col-lg-4">
							<div class="form-group">
								<label>Actividad Genérica*</label>
								<select class="form-control" name="actgen" ng-model="ActGen" required>
								{% for actividad in actgenIn %}
									<option value="{{actividad}}">{{actividad}}</option>
								{% endfor %}
								</select>
							</div>
							</div>
							<div class="col-lg-9 col-lg-4">
							<div class="form-group">
								<label>Producto*</label>
								<select class="form-control" name="prodtIndustria" ng-model="prodtIndustria" required>
									<option ng-repeat="producto in productosIndustria | filter: {Producto: ActGen}| orderBy:'Actividad'" value="[[producto.CodActividad]]">[[producto.Actividad]]</option>
								</select>
							</div>
							</div>
							<div class="col-lg-9 col-lg-12">
							<div class="form-group">
								<label>Descripción del Producto</label>
								<textarea class="form-control" rows="3" ng-model="descripcion"></textarea>
							</div>
							</div>
							<div class="col-lg-9 col-lg-4">
							<div class="form-group">
								<label>F. inscripción producto AE*</label>
								<input id="f_ins_ae" type="date" class="form-control" name="f_ins_ae" ng-model="f_ins_ae" required>
							</div>
							</div>
							<div class="col-lg-9 col-lg-4">
							<div class="form-group">
								<label>Capacidad de producción(Kilos)*</label>
								<input id="c_prod" class="form-control" name="c_prod" ng-model="c_prod" required>
							</div>
							</div>
						</div>
						<div class="col-lg-12">
						</div>
						<div class="col-lg-3">
							<div class="form-group">
								<label>Tamaños envases*</label>
								<ul class="list-group">
									<li class="list-group-item">
										<div class="input-group">
											<input type="text" class="form-control" placeholder="Indique cantidad" ng-model="cant_tam" pattern="\d+(.\d{1,3})?">
											  <span class="input-group-btn">
												<button type="button" class="btn btn-default" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">[[medida]] <span class="caret"></span></button>
												<ul class="dropdown-menu dropdown-menu-right">
												  <li><a href="" ng-click="anadeMedida('g','G')">Gramos</a></li>
												  <li><a href="" ng-click="anadeMedida('l','L')">Litros</a></li>
												  <li><a href="" ng-click="anadeMedida('kg','K')">Kilogramos</a></li>
												  <li><a href="" ng-click="anadeMedida('ml','M')">Mililitros</a></li>
												</ul>
												<button class="btn btn-default" type="button" ng-click="anadeTamanyo()"><i class="fa fa-plus-circle"></i></button>
											  </span>
										</div>
									</li>
									<li ng-repeat="tamanyo in tamanyos" class="list-group-item">
									<a href="" ng-click="eliminaTamanyo(tamanyo.id)"><i class="fa fa-trash-o text-danger"></i></a> [[tamanyo.cantidad]] [[tamanyo.medida]]</li>
								</ul>
							</div>
						</div>
						<div class="col-lg-9">
							<div class="col-lg-9 col-lg-4">
								<div class="form-group">
									<label>Forma de presentación*</label>
									<select class="form-control" name="for_pres" ng-model="for_pres" required>
										<option value=1>A granel</option>
										<option value=2>Envasado cerrado</option>
										<option value=3>Otros</option>
									</select>	
									</br>
									<label>Valor comercialización*</label>
									<div class="input-group">
										  <input type="text" class="form-control" ng-model="v_comer" required pattern="\d+(.\d{1,2})?">
										  <span class="input-group-addon">€</span>
									</div>

								</div>
							</div>

							<div class="col-lg-9 col-lg-6">
								<div class="form-group">
									<label>Marcas de Referencia*</label>
									<ul class="list-group">
										<li class="list-group-item">
											<div class="input-group">
												<input type="text" class="form-control" placeholder="Añadir marca de referencia" ng-model="m_ref">
												  <span class="input-group-btn">
													<button class="btn btn-default" type="button" ng-click="anadeMarca()"><i class="fa fa-plus-circle"></i></button>
												  </span>
											</div>
										</li>
										<li ng-repeat="marca in marcas" class="list-group-item">
										<a href="" ng-click="eliminaMarca(marca.id)"><i class="fa fa-trash-o text-danger"></i></a>	[[marca.marca]]</li>
									</ul>
								</div>
							</div>
						</div>
							{% endif %}
							<div ng-show="parcela.eco == 'SI' ">
							
							<div class="col-lg-12">
								<div class="form-group">
									<h5>¿Tiene declaración PAC?
									<label class="text-success">SI<input id="dpac" type="radio" ng-model="parcela.dpac" value="SI"></label>
													&nbsp;&nbsp;&nbsp;
									<label class="text-danger">NO<input id="dpac" type="radio" ng-model="parcela.dpac" value="NO"></label></h5>
								</div>
							</div>
							
							{% if expediente.tipoAgricultura == 'AE' %}
							<div class="col-lg-3">
								<div class="form-group">
									<label>Cosecha anual*</label>
									<input id="cosecha" class="form-control" name="cosecha" ng-model="parcela.cosecha" required>
								</div>
							</div>
							{% endif %}
							
							
							<div class="col-lg-3">
								<div class="form-group">
									<label>Fecha de inicio de control*</label>
									<input id="fcontrol" type="date" class="form-control" name="fcontrol" ng-model="fcontrol" required>
								</div>
							</div>
							<div class="col-lg-3">
								<div class="form-group">
									<label>F. inscripción AE*</label>
									<input id="fae" type="date" class="form-control" name="fae" ng-model="fae" required>
								</div>
							</div>
							
							{% if expediente.tipoAgricultura != 'IN' %}
							<div class="col-lg-4">
								<div class="form-group">
									<label>Calificación*</label>
									<select class="form-control" name="calificacion" ng-model="parcela.calificacion" required>
										<option value="1">Primer año en prácticas</option>
										<option value="2">Período conversión</option>
										<option value="3">Agricultura Ecológica</option>
									</select>
								</div>
							</div>
							
							<div class="col-lg-3">
								<div class="form-group">
									<label>Fecha de calificación*</label>
									<input id="fcalif" type="date" class="form-control" name="fcalif" ng-model="parcela.fcalif" required>
								</div>
							</div>
							{% endif %}

							</div>
							
							
							
						</form>
					</div>
						</div>
						<div class="modal-footer">
							<div class="pull-left"><button type="button" class="btn btn-default" ng-click="limpiarParcela()"><i class="fa fa-eraser"></i> Limpiar</button></div>
							<button type="button" class="btn btn-warning pull-right" ng-click="guardarParcela1(finscri,'{{expediente.id}}','{{expediente.tipoAgricultura}}')"><i class="fa fa-save"></i> Guardar</button>
						</div>
					</div>
				</div>
				
				</br>
				{% endif %}
				{% if consultaparcela == 'SI' %}
				<div class="panel panel-success">
				<div class="panel-heading" role="tab" id="headingOne">
						<h4 class="panel-title">
							{% 	if expediente.tipoAgricultura != 'IN' %}
							<a data-toggle="collapse" href="" data-target="#ecologica" aria-expanded="false" aria-controls="ecologica">
								<i class="fa fa-plus-circle"></i> Parcelas Agricultura Ecológica
							</a>
							{% else %}
							<a data-toggle="collapse" href="" data-target="#ecologica" aria-expanded="false" aria-controls="ecologica">
								<i class="fa fa-plus-circle"></i> Productos Industriales Ecológicos
							</a>
							{% endif %}
						</h4>
					</div>
				<div class="collapse" id="ecologica">
			  
				<!-- /.panel-heading -->
				
				<div class="panel-body">

					<div class="table-responsive">
						
						<table class="table table-striped table-bordered table-hover">
							
							<thead>
								{% if expediente.tipoAgricultura == 'IN' %}
								<tr>
									<th>Municipio</th>
									<th>Producto</th>
									<th>Presentación</th>
									<th>Valor producción</th>
									<th>Declara PAC</th>
								</tr>
								{% else %}
								<tr>
									<th>Provincia</th>
									<th>Municipio</th>
									<th>Polígono</th>
									<th>Parcela</th>
									<th>Recinto</th>
									<th>Producto</th>
									<th>Superficie(Ha)</th>
									<th>Declara PAC</th>
								</tr>
								{% endif %}
							</thead>
							{% if expediente.tipoAgricultura != 'IN' %}
							<tbody>
								
								<tr ng-repeat="parcela in parcelas|  filter :{ag_eco: 'SI'}">
									{% if expediente.tipoAgricultura == 'AE' %}
									<td><a href="/parcelas/[[parcela.id]]">[[parcela.prov]] ([[parcela.codprov]])</a></td>
									<td><a href="/parcelas/[[parcela.id]]">[[parcela.mun]] ([[parcela.codmun]])</a></td>
									<td><a href="/parcelas/[[parcela.id]]">[[parcela.poligono]]</a></td>
									<td><a href="/parcelas/[[parcela.id]]">[[parcela.parcela]]</a></td>
									<td><a href="/parcelas/[[parcela.id]]">[[parcela.recinto]]</a></td>
									<td>[[parcela.cultivo]]</td>
									{% elif expediente.tipoAgricultura == 'GA'%}
									<td><a href="/parcelasGanaderia/[[parcela.id]]">[[parcela.prov]] ([[parcela.codprov]])</a></td>
									<td><a href="/parcelasGanaderia/[[parcela.id]]">[[parcela.mun]] ([[parcela.codmun]])</a></td>
									<td><a href="/parcelasGanaderia/[[parcela.id]]">[[parcela.poligono]]</a></td>
									<td><a href="/parcelasGanaderia/[[parcela.id]]">[[parcela.parcela]]</a></td>
									<td><a href="/parcelasGanaderia/[[parcela.id]]">[[parcela.recinto]]</a></td>
									<td>[[parcela.Orientacion]]</td>
									{% endif %}
									<td>[[parcela.superficie_hectareas]]</td>
									<td>[[parcela.declar_pac]]</td>
									<td>
										<a href="" ng-click="eliminarParcela2(parcela.id,'{{expediente.tipoAgricultura}}')"><i class="fa fa-trash-o text-danger"></i></a>
									</td>
								</tr>
							</tbody>
							{% else %}
							<tbody>
							
								<tr ng-repeat="parcela in parcelas|  filter :{ag_eco: 'SI'}" >
									<td><a href="/productoIndustrial/[[parcela.id]]">[[parcela.mun]] ([[parcela.prov]])</a></td>
									<td><a href="/productoIndustrial/[[parcela.id]]">[[parcela.actgen]]</a></td>
									<td>[[pres(parcela.form_pres)]]</td>
									<td>[[parcela.valor_produccion]] €</td>
									<td>[[parcela.declar_pac]]</td>
									<td>
										<a href="" ng-click="eliminarParcela2(parcela.id,'{{expediente.tipoAgricultura}}')"><i class="fa fa-trash-o text-danger"></i></a>
									</td>
								</tr>
		
							</tbody>
							{% endif %}
						</table>
						<div ng-show="siguiente4">
							No existen parcelas
						</div>
					</div>
					{% if expediente.tipoAgricultura != 'IN' %}
					<div class="alert alert-success col-lg-3 pull-right" role="alert">
					  Superficie TOTAL(Ha): [[superficie1]] ha
					</div>
					{% endif %}
				</div>
				
				</div>

			</div>

			<div class="panel panel-danger">
				<div class="panel-heading" role="tab" id="headingOne">
						<h4 class="panel-title">
							{% if expediente.tipoAgricultura != 'IN' %}
							<a data-toggle="collapse" href="" data-target="#noecologica" aria-expanded="false" aria-controls="noecologica">
								<i class="fa fa-plus-circle"></i> Parcelas Agricultura NO Ecológica
							</a>
							{% else %}
							<a data-toggle="collapse" href="" data-target="#noecologica" aria-expanded="false" aria-controls="noecologica">
								<i class="fa fa-plus-circle"></i> Productos Industriales NO Ecológicos
							</a>
							{% endif %}
						</h4>
					</div>
				<div class="collapse" id="noecologica">
				<!-- /.panel-heading -->
				<div class="panel-body">

					<div class="table-responsive">
					

						<table class="table table-striped table-bordered table-hover">
							
						   <thead>
								{% if expediente.tipoAgricultura == 'IN' %}
								<tr>
									<th>Municipio</th>
									<th>Producto</th>
									<th>Presentación</th>
									<th>Valor producción</th>
								</tr>
								{% else %}
								<tr>
									<th>Provincia</th>
									<th>Municipio</th>
									<th>Polígono</th>
									<th>Parcela</th>
									<th>Recinto</th>
									<th>Producto</th>
									<th>Superficie(Ha)</th>
								</tr>
								{% endif %}
							</thead>
							{% if expediente.tipoAgricultura != 'IN' %}
							<tbody>
								
								<tr ng-repeat="parcela in parcelas|  filter :{ag_eco: 'NO'}">
									{% if expediente.tipoAgricultura == 'AE' %}
									<td><a href="/parcelas/[[parcela.id]]">[[parcela.prov]] ([[parcela.codprov]])</a></td>
									<td><a href="/parcelas/[[parcela.id]]">[[parcela.mun]] ([[parcela.codmun]])</a></td>
									<td><a href="/parcelas/[[parcela.id]]">[[parcela.poligono]]</a></td>
									<td><a href="/parcelas/[[parcela.id]]">[[parcela.parcela]]</a></td>
									<td><a href="/parcelas/[[parcela.id]]">[[parcela.recinto]]</a></td>
									<td>[[parcela.cultivo]]</td>
									{% elif expediente.tipoAgricultura == 'GA'%}
									<td><a href="/parcelasGanaderia/[[parcela.id]]">[[parcela.prov]] ([[parcela.codprov]])</a></td>
									<td><a href="/parcelasGanaderia/[[parcela.id]]">[[parcela.mun]] ([[parcela.codmun]])</a></td>
									<td><a href="/parcelasGanaderia/[[parcela.id]]">[[parcela.poligono]]</a></td>
									<td><a href="/parcelasGanaderia/[[parcela.id]]">[[parcela.parcela]]</a></td>
									<td><a href="/parcelasGanaderia/[[parcela.id]]">[[parcela.recinto]]</a></td>
									<td>[[parcela.Orientacion]]</td>
									{% endif %}
									<td>[[parcela.superficie_hectareas]]</td>
									<td>
										<a href="" ng-click="eliminarParcela2(parcela.id,'{{expediente.tipoAgricultura}}')"><i class="fa fa-trash-o text-danger"></i></a>
									</td>
								</tr>
							</tbody>
							{% else %}
							<tbody>
							
								<tr ng-repeat="parcela in parcelas|  filter :{ag_eco: 'NO'}" >
									<td><a href="/productoIndustrial/[[parcela.id]]">[[parcela.mun]] ([[parcela.prov]])</a></td>
									<td><a href="/productoIndustrial/[[parcela.id]]">[[parcela.actgen]]</a></td>
									<td>[[pres(parcela.form_pres)]]</td>
									<td>[[parcela.valor_produccion]] €</td>
									<td>
										<a href="" ng-click="eliminarParcela2(parcela.id,'{{expediente.tipoAgricultura}}')"><i class="fa fa-trash-o text-danger"></i></a>
									</td>
								</tr>
		
							</tbody>
							{% endif %}
						</table>
						<div ng-show="siguiente5">
							No existen parcelas
						</div>
					</div>
					 {% if expediente.tipoAgricultura != 'IN' %}
					<div class="alert alert-danger col-lg-3 pull-right" role="alert">
					  Superficie TOTAL(Ha): [[superficie2]] ha
					</div>
					{% endif %}
					
				</div>
				</div>

			</div>
			{% endif %}
			</div>
			</div>
			
			<div role="tabpanel" class="tab-pane" id="Visitas">
				<div class="list-group col-lg-3">
					<li class="list-group-item list-group-item-info text-center"><strong>REGISTRO DE VISITAS</strong></li>
					<a id = "Pla" href="#Planificacion" class="list-group-item active" aria-controls="Planificacion" role="tab" data-toggle="tab" ng-click="cambiaPanel('Pla')"><strong>1. Planificación</strong></a>
					{% if creaAuditorias == 'SI' or consultaAuditorias == 'SI' or modificaAuditorias == 'SI' or tipoUs == 'A'%}
					    <a id="Aud" href="#Auditoria" class="list-group-item" aria-controls="Auditoria" role="tab" data-toggle="tab" ng-click="cambiaPanel('Aud')"><strong>2. Auditoría</strong></a>
					    <a id="Inc" href="#Incumplimientos" class="list-group-item" aria-controls="Incumplimientos" role="tab" data-toggle="tab" ng-click="cambiaPanel('Inc')"><strong>3. Incumplimientos</strong></a>
					    <a id="Inf" href="#InformeVisita" class="list-group-item" aria-controls="InformeVisita" role="tab" data-toggle="tab" ng-click="cambiaPanel('Inf')"><strong>4. Informe de Visita</strong></a>
					    <a id="Acc" href="#Acciones" class="list-group-item" aria-controls="Acciones" role="tab" data-toggle="tab" ng-click="cambiaPanel('Acc')"><strong>5. Acciones Correctivas</strong></a>
					    <a id="Eva"href="#Evaluacion" class="list-group-item" aria-controls="Evaluacion" role="tab" data-toggle="tab" ng-click="cambiaPanel('Eva')"><strong>6. Informe de Evaluación</strong></a>
					{% endif %}
					{% if certifica == 'SI'%}<a id="Cer" href="#Certificacion" class="list-group-item " aria-controls="Certificacion" role="tab" data-toggle="tab" ng-click="cambiaPanel('Cer')"><strong>7. Certificación</strong></a>{% endif %}
						<a id="Vis" href="#Visit" class="list-group-item list-group-item-success" aria-controls="Visit" role="tab" data-toggle="tab" ng-click="cambiaPanel('Vis')"><strong>8. Visitas Completadas</strong></a>				
					</div>

					
					<div class="tab-content col-lg-9">
					 
					<div role="tabpanel" class="tab-pane active" id="Planificacion">
					
						<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">

							<div class="panel panel-info">
								<div class="panel-heading" role="tab" id="headingOne">
									<h4 class="panel-title">
										<a ng-hide="modificaVisita" data-toggle="collapse" href="" data-target="#planificacion" aria-expanded="false" aria-controls="planificacion">
											<i class="fa fa-plus-circle"></i> 1. Planificación
										</a>
										<a ng-show="modificaVisita" data-toggle="collapse" href="" data-target="#planificacion" aria-expanded="false" aria-controls="planificacion">
											<i class="fa fa-plus-circle"></i> 1. Modifica Planificación
										</a>
									</h4>
								</div>
								<div class="collapse" id="planificacion">
									<div class="panel-body">
										<div class="row">
											<form id="formularioVisita"class="css-form" name="formularioVisita" role="form" action="." method="POST">{% csrf_token %}
													
												<div class="col-lg-5">
													<div class="form-group">
														<label>Tipo de actuación*</label>
														<select class="form-control" name="tact" ng-model="tact" required>
															<option  selected="true" style="display:none;" value="">Selecciona tipo de actuación</option>
															<option value="Auditoria Inicial Anunciada">Auditoria Inicial Anunciada</option>
															<option value="Auditoria Anual Anunciada">Auditoria Anual Anunciada</option>
															<option value="Auditoria Adicional Anunciada">Auditoria Adicional Anunciada</option>
															<option value="Auditoria Inicial No Anunciada">Auditoria Inicial No Anunciada</option>
															<option value="Auditoria Anual No Anunciada">Auditoria Anual No Anunciada</option>
															<option value="Auditoria Adicional No Anunciada">Auditoria Adicional No Anunciada</option>
														</select>
														<div class="error-container" ng-show="formularioVisita.tact.$dirty && formularioVisita.tact.$invalid">
															<small class="error text-danger" ng-show="formularioVisita.tact.$error.required">Este campo es requerido</small>
														</div>
													</div>
												</div>
												
												<div class="col-lg-4">
													<div class="form-group">
														<label>Auditor*</label>
														{% if tipoUs != 'A' %}
														<select class="form-control" name="inspector" ng-model="inspector" required>
															<option  selected="true" style="display:none;" value="">Selecciona Inspector</option>
															{% for inspector in auditores %}
															<option value="{{inspector.id}}">{{inspector.Nombre}} {{inspector.Apellido1}} {{inspector.Apellido2}}</option>
															{% endfor %}
														</select>
														<div class="error-container" ng-show="formularioVisita.inspector.$dirty && formularioVisita.inspector.$invalid">
															<small class="error text-danger" ng-show="formularioVisita.inspector.$error.required">Este campo es requerido</small>
														</div>
														{% else %}
														<p>{{auditor}}</p>
														{% endif %}
													</div>
												</div>
												
												<div class="col-lg-3">
													<div class="form-group">
														<label>Fecha de la actuación*</label>
														<input id="fvisita" type="date" class="form-control" name="fvisita" ng-model="fvisita" required>
														<div class="error-container" ng-show="formularioVisita.fvisita.$dirty && formularioVisita.fvisita.$invalid">
															<small class="error text-danger" ng-show="formularioVisita.fvisita.$error.required">Este campo es requerido</small>
														</div>
													</div>
												</div>
												
												<div class="col-lg-4">
													<div class="form-group">
														<label>Provincia</label>
														<select id ="provSelect"class="form-control" name="provincia" ng-model="provSelect" required>
															<option  selected="true" style="display:none;" value="">Selecciona Provincia</option>
															{% for provincia in provincias %}
																<option value="{{provincia.id}}">{{provincia.CodProvincia}} - {{provincia.Provincia}}</option>
															{% endfor %}
														</select>
													</div>
												</div>
							
												<div class="col-lg-8">
													<div class="form-group">
														<label ng-show="RIA == 'SI' || !RIA">Municipio</label>
														<select id="munSelect" class="form-control" name="municipio" ng-model="munSelect" required>
															<option  selected="true" style="display:none;" value="">Selecciona Municipio</option>
															<option ng-repeat="municipio in municipios  | filter: {idProvincia: provSelect}" value="[[municipio.id]]">[[municipio.CodCatastral]] - [[municipio.Municipio]]</option>
														</select>
													</div>
												</div>
												<div class="col-lg-2">
												</div>
												<div class="col-lg-8">
												<div class="panel panel-default">
							
													<div class="panel-heading">
														{% if expediente.tipoAgricultura != 'IN'%}
														<strong>Parcelas Asociadas</strong>
														{% else %}
														<strong>Instalaciones Asociadas</strong>
														{% endif %}
													</div>
													<!-- /.panel-heading -->
													<div class="panel-body">
														<div class="table-responsive" style="max-height: 180px ;overflow-y: scroll;">
															<table class="table table-striped table-bordered table-hover" >
																
																<thead>
																	<tr>
																		<th width="30"><input type="checkbox" id="selectTodos" ng-model="selectTodos" ng-change="compruebaEstado()"></th>
																		{% if expediente.tipoAgricultura = 'AE' %}
																		<th class="text-center">Referencia SIGPAC</th>
																		{% elif expediente.tipoAgricultura == 'GA' %}
																		<th class="text-center">Código REGA</th>
																		{% elif expediente.tipoAgricultura == 'IN' %}
																		<th class="text-center">Nº Registro RIA</th>
																		{% endif %}
																		<th width="30"></th>
																
																	</tr>
																</thead>
																<tbody>
																	<tr ng-repeat ="parcela in parcelas| filter: {municipio: munSelect,ag_eco: 'SI'}">
																		<td><input type="checkbox" id="blankCheckbox[[parcela.id]]" class="blankCheckbox" value="[[parcela.id]]" ng-model="selectTodos"></td>
																		{% if expediente.tipoAgricultura = 'AE' %}
																		<td class="text-center">[[parcela.codprov| limitTo:-2]][[parcela.codmun]][[parcela.poligono]][[parcela.parcela]][[parcela.recinto]]</td>
																		{% elif expediente.tipoAgricultura == 'GA'%}
																		<td class="text-center">[[parcela.codExplotREGA]]</td>
																		{% elif expediente.tipoAgricultura == 'IN' %}
																		<td class="text-center">[[parcela.matriculaRIA]]</td>
																		{% endif %}
																		<td></td>
																	</tr>
																</tbody>
															</table>
														</div>
														</br>
														<button type="button" class="btn btn-info pull-right" ng-click="cargarDatos('{{expediente.tipoAgricultura}}')"><i class="fa fa-gear"></i> Cargar Seleccionadas</button>
													</div>
													

												</div>
												</div>
												
												
												<div class="col-lg-12">
												</div>
												<div class="col-lg-2">
												</div>

												<div class="col-lg-8">
												</br>
												<div class="panel panel-success">
							
													<div class="panel-heading">
														<strong>Referencias Cargadas</strong>
													</div>
													<!-- /.panel-heading -->
													<div class="panel-body"  style="max-height: 200px ;overflow-y: scroll;">
														<div class="table-responsive">
															<table class="table table-striped table-bordered table-hover">
																
																<thead>
																	<tr>
																		<th class="text-center" ng-show="modificaVisita" width="110">Estado</th>
																		{% if expediente.tipoAgricultura = 'AE' %}
																		<th class="text-center">Referencia SIGPAC</th>
																		{% elif expediente.tipoAgricultura == 'GA' %}
																		<th class="text-center">Código REGA</th>
																		{% elif expediente.tipoAgricultura == 'IN' %}
																		<th class="text-center">Nº Registro RIA</th>
																		{% endif %}
																		<th width="30"></th>
																		
																
																	</tr>
																</thead>
																<tbody>
																	<tr ng-repeat ="parcela in cargadas">
																		
																		<td class="text-center" ng-show="modificaVisita">
																			<select id ="estadoCargada[[parcela.id]]" class="form-control" name="estadoCargada" ng-model="parcela.incidencia" ng-change="cambiaEstadoCargada(parcela.id)">
																				<option value="BAJA">BAJA</option>
																				<option value="ALTA">ALTA</option>
																			</select>		
																		</td>
																		{% if expediente.tipoAgricultura == 'AE' %}
																		<td class="text-center" ng-hide="modificaVisita">[[parcela.codprov| limitTo:-2]][[parcela.codmun]][[parcela.poligono]][[parcela.parcela]][[parcela.recinto]]</td>
																		<td class="text-center" ng-show="modificaVisita">[[parcela.codprov| limitTo:-2]][[parcela.codmun]][[parcela.poligono]][[parcela.parce]][[parcela.recinto]]</td>
																		{% elif expediente.tipoAgricultura == 'GA' %}
																		<td class="text-center">[[parcela.codExplotREGA]]</td>
																		{% elif expediente.tipoAgricultura == 'IN' %}
																		<td class="text-center">[[parcela.matriculaRIA]]</td>
																		{% endif %}
																		<td><a href="" ng-click="eliminaCargada(parcela.id,'{{expediente.tipoAgricultura}}')"><i class="fa fa-trash-o text-danger"></i></a></td>
																	</tr>
																</tbody>
															</table>
														</div>
														
													</div>

												</div>
												</div>
												
												
												<div class="col-lg-12" ng-show="motivoBaja">
													</br>
													<div class="alert alert-danger" role="alert">	
														<label>Motivo de la Baja (OBLIGATORIO)</label>
														<textarea class="form-control" rows="3" ng-model="motivo"></textarea>
														<br/>
														<button type="button" class="btn btn-danger" ng-click="cancelaBaja()">Cancelar</button>
														<button type="button" class="btn btn-success" ng-click="darDeBaja('{{expediente.tipoAgricultura}}')"><i class="fa fa-save"></i> Dar de Baja</button>
													</div>
												</div>
												<div class="col-lg-12">
													<div class="form-group">
														</br>	
														<label>Observaciones</label>
														<textarea class="form-control" rows="3" ng-model="descripcion"></textarea>
													</div>
												</div>
												
											</form>
										</div>
									</div>
									<div class="modal-footer">
										<div class="pull-left"><button type="button" class="btn btn-default" ng-click="limpiarVisita()"><i class="fa fa-eraser"></i> Limpiar</button></div>
										<button type="button" class="btn btn-danger" ng-click="CancelaMod()" ng-show="modificaVisita">Cancelar</button>
										{% if tipoUs == 'A' %}
										<button type="button" class="btn btn-info" ng-click="modificaPlan('{{expediente.id}}','{{auditor.id}}')" ng-show="modificaVisita"><i class="fa fa-save"></i> Modificar</button>
										<button type="button" class="btn btn-info pull-right" ng-click="guardarVisita2('{{expediente.id}}','{{auditor.id}}','{{expediente.tipoAgricultura}}')" ng-hide="modificaVisita"><i class="fa fa-save"></i> Guardar</button>
										{% else %}
										<button type="button" class="btn btn-info" ng-click="modificaPlan('{{expediente.id}}',inspector)" ng-show="modificaVisita"><i class="fa fa-save"></i> Modificar</button>
										<button type="button" class="btn btn-info pull-right" ng-click="guardarVisita('{{expediente.id}}','{{expediente.tipoAgricultura}}')" ng-hide="modificaVisita"><i class="fa fa-save"></i> Guardar</button>
										{% endif %}
									</div>
								</div>
							</div>
							</div>
							{% if consultaPlanificadas == 'SI' %}
							<div class="panel panel-info">
							
								<div class="panel-heading">
									<strong>Visitas Planificadas</strong>
								</div>
								<!-- /.panel-heading -->
								<div class="panel-body" style="max-height: 308px ;overflow-y: scroll;">
								
								
									<div class="table-responsive" >

										<table class="table table-striped table-bordered table-hover" >
											
											<thead>
												<tr>
													<th width="30"></th>
													<th>Fecha Actuación</th>
													<th>Tipo Actuación</th>
													<th>Inspector</th>
													<th width="30"></th>
											
												</tr>
											</thead>
											<tbody>
												{% if tipoUs == 'A' %}
												<tr ng-repeat ="visita in planificadasAuditor| orderBy:'f_visita '">
													<td>{% if modificaPlanificadas == 'SI' %}<a href="" ng-click="editaVisita(visita.id,'{{expediente.tipoAgricultura}}')"><i class="fa fa-edit text-info"></i>{% endif %}</td>
													<td>[[visita.f_visita| date: 'dd/MM/yyyy']]</td>
													<td>[[visita.actuacion]]</td>
													<td>[[visita.nombreIns]] [[visita.apellido1Ins]] [[visita.apellido2Ins]]</td>
													<td>
														{% if modificaPlanificadas == 'SI' %}<a href="" ng-click="eliminarVisita(visita.id,5)"><i class="fa fa-trash-o text-danger"></i></a>{% endif %}
													</td>
												</tr>
												{% else %}
												<tr ng-repeat ="visita in planificadas| orderBy:'f_visita '">
													<td>{% if modificaPlanificadas == 'SI' %}<a href="" ng-click="editaVisita(visita.id,'{{expediente.tipoAgricultura}}')"><i class="fa fa-edit text-info"></i>{% endif %}</td>
													<td>[[visita.f_visita| date: 'dd/MM/yyyy']]</td>
													<td>[[visita.actuacion]]</td>
													<td>[[visita.nombreIns]] [[visita.apellido1Ins]] [[visita.apellido2Ins]]</td>
													<td>
														{% if user.is_staff %}<a href="" ng-click="eliminarVisita(visita.id,2)"><i class="fa fa-trash-o text-danger"></i></a>{% endif %}
													</td>
												</tr>
												{% endif %}
											</tbody>
										</table>
									</div>
									
								</div>

							</div>
							{% endif %}
						</div>
						<div role="tabpanel" class="tab-pane" id="Auditoria">
						
							<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
							{% if creaAuditorias == 'SI' or tipoUs == 'A' %}
							<div class="panel panel-warning">
								<div class="panel-heading" role="tab" id="headingOne">
									<h4 class="panel-title">
										<a ng-hide="modificaAuditoria" data-toggle="collapse" href="" data-target="#auditoria" aria-expanded="false" aria-controls="auditoria">
											<i class="fa fa-plus-circle"></i> 2. Auditoría	
										</a>
										<a ng-show="modificaAuditoria" data-toggle="collapse" href="" data-target="#auditoria" aria-expanded="false" aria-controls="auditoria">
											<i class="fa fa-plus-circle"></i> 2. Modifica Auditoría	
										</a>
									</h4>
								</div>
								<div class="collapse" id="auditoria">
									<div class="panel-body">
						
								<div class="row">
									<form id="formularioVisita2"class="css-form" name="formularioVisita" role="form" action="." method="POST">{% csrf_token %}
										
										
										<div class="col-lg-3">
											<div class="form-group">
												<label>Visita planificada*</label>
												{% if tipoUs == 'A' %}
												<select class="form-control" name="inspector" ng-model="visitaPlanif" ng-change="comparaAuditor('{{auditor.id}}')" required>
													<option  selected="true" style="display:none;" value="">Selecciona visita</option>
													<option ng-show="modificaAuditoria" ng-repeat ="visita in planificadasAuditor| orderBy:'f_visita '" value="[[visita.id]]">[[visita.f_visita| date: 'dd/MM/yyyy']]</option>
													<option ng-hide="modificaAuditoria" ng-repeat ="visita in planificadasAuditor| filter: {completada: 'NO'} | orderBy:'f_visita '" value="[[visita.id]]">[[visita.f_visita| date: 'dd/MM/yyyy']]</option>
												</select>
												{% else %}
												<select class="form-control" name="inspector" ng-model="visitaPlanif" ng-change="comprueba()" required>
													<option  selected="true" style="display:none;" value="">Selecciona visita</option>
													<option ng-show="modificaAuditoria" ng-repeat ="visita in planificadas| orderBy:'f_visita '" value="[[visita.id]]">[[visita.f_visita| date: 'dd/MM/yyyy']] - [[visita.nombreIns]] [[visita.apellido1Ins]]</option>
													<option ng-hide="modificaAuditoria" ng-repeat ="visita in planificadas| filter: {completada: 'NO'} | orderBy:'f_visita '" value="[[visita.id]]">[[visita.f_visita| date: 'dd/MM/yyyy']] - [[visita.nombreIns]] [[visita.apellido1Ins]]</option>
												</select>
												{% endif %}
											</div>
										</div>
											
										{% if tipoUs == 'A' %}
										<div class="col-lg-3">
											<div class="form-group">
												<label>Fecha de la visita*</label>
												<input id="faudi" type="date" class="form-control" name="faudi" ng-model="faudi" ng-change="comparaAuditor('{{auditor.id}}')" required>
											</div>
										</div>
										{% else %}
										<div class="col-lg-3">
											<div class="form-group">
												<label>Fecha de la visita*</label>
												<input id="faudi" type="date" class="form-control" name="faudi" ng-model="faudi" ng-change="comprueba()" required>
											</div>
										</div>
										{% endif %}
										<div class="col-lg-3">
											<div class="form-group">
												<label>Precisa PAC*</label>
												<select id="solicitaPAC" class="form-control" name="solicitaPAC" ng-model="solPac" required>
													<option value="SI" selected>SI</option>
													<option value="NO">NO</option>
												</select>
											</div>
										</div>
										<div class="col-lg-3">
											<div class="form-group">
												<label>Código Acta*</label>
												<input class="form-control" id="acta" name="acta" ng-model="acta" required>
											</div>
										</div>
										
										<div class="col-lg-4">
											<div class="form-group">
												<label>Nº Incumplimientos Totales*</label>
												<input class="form-control" id="incump" name="incump" ng-model="visita.incump" required>
												<div class="error-container" ng-show="formularioVisita.incump.$dirty && formularioVisita.incump.$invalid">
													<small class="error text-danger" ng-show="formularioVisita.incump.$error.required">Este campo es requerido</small>
												</div>
											</div>
										</div>
														
										<div class="col-lg-4">
											<div class="form-group">
												<label>Nº Muestras Recogidas*</label>
												<input class="form-control" id="muestras" name="muestras" ng-model="visita.muestras" required>
												<div class="error-container" ng-show="formularioVisita.muestras.$dirty && formularioVisita.muestras.$invalid">
													<small class="error text-danger" ng-show="formularioVisita.muestras.$error.required">Este campo es requerido</small>
												</div>
											</div>
										</div>
										
										<div class="col-lg-4">
											<div class="form-group">
												<label>Acta de Muestreo</label>
												<select id="actaM" class="form-control" name="actaM" ng-model="actaM">
													<option value="SI" selected>SI</option>
													<option value="NO">NO</option>
												</select>
											</div>
										</div>
										
										<div class="col-lg-9">
											<div class="form-group">
												<label>Descripción análisis de muestras (Cada tipo de análisis separado por ";")</label>
												<textarea class="form-control" rows="3" ng-model="descmuestras" placeholder="Ejemplo: Análisis de suelo; Análisis foliar; Análisis de residuos de plaguicidas en cosecha"></textarea>
											</div>
										</div>
										
										
										
										<div class="col-lg-9">
											<div class="form-group">
												<label>Resumen de la Auditoría</label>
												<textarea class="form-control" rows="3" ng-model="descripcion2"></textarea>
											</div>
										</div>
										
										<div class="col-lg-9">
											<div class="form-group">
												<label>Observaciones</label>
												<textarea class="form-control" rows="3" ng-model="observ1"></textarea>
											</div>
										</div>
										
									
									</form>
								</div>
								</div>
								<div class="modal-footer">
									<div class="pull-left"><button type="button" class="btn btn-default" ng-click="limpiarVisita()"><i class="fa fa-eraser"></i> Limpiar</button></div>
									<button type="button" class="btn btn-danger" ng-click="CancelaMod()" ng-show="modificaAuditoria">Cancelar</button>
									{% if tipoUs == 'A' %}
									<button type="button" class="btn btn-info" ng-click="modificaAudi('{{expediente.id}}','{{auditor.id}}')" ng-show="modificaAuditoria"><i class="fa fa-save"></i> Modificar</button>
									<button id="auditoriaBoton" type="button" class="btn btn-warning pull-right" ng-click="guardarAuditoria2()" disabled ng-hide="modificaAuditoria"><i class="fa fa-save"></i> Guardar</button>
									{% else %}
									<button type="button" class="btn btn-info" ng-click="modificaAudi('{{expediente.id}}',inspector)" ng-show="modificaAuditoria"><i class="fa fa-save"></i> Modificar</button>
									<button id="auditoriaBoton" type="button" class="btn btn-warning pull-right" ng-click="guardarAuditoria()" disabled ng-hide ="modificaAuditoria"><i class="fa fa-save"></i> Guardar</button>
									{% endif %}
								</div>
							</div>
							</div>
							{% endif %}
							</div>
							{% if consultaAuditorias == 'SI' or tipoUs == 'A' %}
							<div class="panel panel-warning">
							
								<div class="panel-heading">
									<strong>Auditorías Realizadas</strong>
								</div>
								<!-- /.panel-heading -->
								<div class="panel-body" style="max-height: 308px ;overflow-y: scroll;">
								
								
									<div class="table-responsive">

										<table class="table table-striped table-bordered table-hover">
											
											<thead>
												<tr>
													<th width="30"></th>
													<th>Fecha Visita</th>
													<th>Nº incumplimientos</th>
													<th>Nº muestras</th>
													<th>Precisa PAC</th>
													<th>Ref. Acta muestras</th>
													<th width="30"></th>
											
												</tr>
											</thead>
											<tbody>
												{% if auditor %}
												<tr ng-repeat ="auditoria in auditoriasAuditor| orderBy:'-f_Auditoria'">
													<td><a href="" ng-click="editaAuditoria(auditoria.id)"><i class="fa fa-edit text-info"></i></td>
													<td>[[auditoria.f_Auditoria | date: 'dd/MM/yyyy']]</td>
													<td>[[auditoria.n_incumplimientos]]</td>
													<td>[[auditoria.n_muestras]]</td>
													<td>[[auditoria.solicita_PAC]]</td>
													<td>[[auditoria.acta]]</td>
													<td>
														<a href="" ng-click="eliminarVisita(auditoria.id,6)"><i class="fa fa-trash-o text-danger"></i></a>
													</td>
												</tr>
												{% else %}
												<tr ng-repeat ="auditoria in auditorias| orderBy:'-f_Auditoria'">
													<td>{% if modificaAuditorias == 'SI' %}<a href="" ng-click="editaAuditoria(auditoria.id)"><i class="fa fa-edit text-info"></i>{% endif %}</td>
													<td>[[auditoria.f_Auditoria | date: 'dd/MM/yyyy']]</td>
													<td>[[auditoria.n_incumplimientos]]</td>
													<td>[[auditoria.n_muestras]]</td>
													<td>[[auditoria.solicita_PAC]]</td>
													<td>[[auditoria.acta]]</td>
													<td>
														{% if modificaAuditorias == 'SI' %}<a href="" ng-click="eliminarVisita(auditoria.id,3)"><i class="fa fa-trash-o text-danger"></i></a>{% endif %}
													</td>
												</tr>
												{% endif %}
						
											</tbody>
										</table>
									</div>
									
								</div>

							</div>
							{% endif %}
							</div>
						<div role="tabpanel" class="tab-pane" id="Incumplimientos">
						
							<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
							{% if creaAuditorias == 'SI' or tipoUs == 'A'%}
							<div class="panel panel-danger">
								<div class="panel-heading" role="tab" id="headingOne">
									<h4 class="panel-title">
										<a ng-hide="modificaIncumplimiento" data-toggle="collapse" href="" data-target="#incumplimientos" aria-expanded="false" aria-controls="incumplimientos">
											<i class="fa fa-plus-circle"></i> 3. Incumplimientos	
										</a>
										<a ng-show="modificaIncumplimiento" data-toggle="collapse" href="" data-target="#incumplimientos" aria-expanded="false" aria-controls="incumplimientos">
											<i class="fa fa-plus-circle"></i> 3. Modifica Incumplimiento	
										</a>
									</h4>
								</div>
								<div class="collapse" id="incumplimientos">
									<div class="panel-body">
									<div class="row">
										<form id="formularioVisita"class="css-form" name="formularioVisita" role="form" action="." method="POST">{% csrf_token %}
												
											<div class="col-lg-4">
												<div class="form-group">
													<label>Auditoría*</label>
													{% if tipoUs == 'A' %}
													<select class="form-control" name="selectAudi" ng-model="selectAudi" ng-change="cambiaAuditoria('{{auditor.id}}')" required>
														<option  selected="true" style="display:none;" value="">Selecciona auditoría</option>
														<option ng-repeat ="auditoria in auditoriasAuditor| orderBy:'-f_Auditoria'" value="[[auditoria.id]]">[[auditoria.f_Auditoria| date: 'dd/MM/yyyy']]</option>
													</select>
													{% else %}
													<select class="form-control" name="selectAudi" ng-model="selectAudi" ng-change="cambiaAuditoria()" required>
														<option  selected="true" style="display:none;" value="">Selecciona auditoría</option>
														<option ng-repeat ="auditoria in auditorias| orderBy:'-f_Auditoria'" value="[[auditoria.id]]">[[auditoria.f_Auditoria| date: 'dd/MM/yyyy']]</option>
													</select>
													{% endif %}
													<p class="text-danger">[[mensaje]]</p>
												</div>
											</div>	
											<div class="col-lg-3">
												<div class="form-group">
													<label>Tipo de incumplimiento*</label>
													<select class="form-control" name="inspector" ng-model="tipoIncp" required>
														<option value="D">Desviación</option>
														<option value="NC">No conformidad</option>
													</select>
												</div>
											</div>
											
											<div class="col-lg-4" ng-show="tipoIncp == 'NC'">
												<div class="form-group">
													<label>Tipo de No conformidad*</label>
													<select class="form-control" name="inspector" ng-model="tipoNC" required>
														<option value="IR">Irregularidad</option>
														<option value="IN">Infracción</option>
													</select>
												</div>
											</div>
											<div class="col-lg-12">

											</div>
											
											<div class="col-lg-4">
												<div class="form-group">
													<label>Objeto del incumplimiento*</label>
													<select class="form-control" name="t_inc" ng-model="t_inc" required>
														<option value="P">Producto</option>
														<option value="I">Instalación</option>
													</select>
												</div>
											</div>
											
											{% if expediente.tipoAgricultura == 'IN' %}
											<div class="col-lg-3">
												<div class="form-group">
													<label>Fase del proceso*</label>
													<select class="form-control" name="fase" ng-model="fase" required>
														<option value=2>Elaboración</option>
														<option value=3>Envasado</option>
														<option value=4>Comercialización</option>
													</select>
												</div>
											</div>
											{% endif %}
											
											
											
											
											<div class="col-lg-3">
												<div class="form-group">
													<label>Tipo de producto*</label>
													<select class="form-control" name="t_product" ng-model="t_product" required>
														<option ng-repeat ="tipo in tipoProductos" value="[[tipo.id]]">[[tipo.producto]]</option>
													</select>
												</div>
											</div>
											
											
											
											<div class="col-lg-3">
												<div class="form-group">
													<label>Apdo. Regl./Proced.</label>
													<input id="apdo" class="form-control" name="apdo" ng-model="apdo">
												</div>
											</div>
											
											<div class="col-lg-6">
												<div class="form-group">
													<label>Parcelas / explotaciones / producto con incumplimiento</label>
													<input id="expl" class="form-control" name="expl" ng-model="expl">
												</div>
											</div>
											
											<div class="col-lg-9">
												<div class="form-group">
													<label>Descripción del incumplimiento*</label>
													<textarea class="form-control" rows="3" ng-model="descripcion3"></textarea>
												</div>
											</div>
											<div class="col-lg-9">
												<div class="form-group">
													<label>Forma de detección del incumplimiento*</label>
													<textarea class="form-control" rows="3" ng-model="forma_deteccion"></textarea>
												</div>
											</div>
											<div class="col-lg-3">
												<div class="form-group">
													<label>Condicionalidad*</label>
													<select class="form-control" name="condicionalidad" ng-model="condicionalidad" required>
														<option value='S'>Si</option>
														<option value='N'>No</option>
													</select>
												</div>
											</div>
											
											<div class="col-lg-9">
												<div class="form-group">
													<label>Observaciones</label>
													<textarea class="form-control" rows="3" ng-model="descripcion4"></textarea>
												</div>
											</div>

											
									</div>
								</div>
								<div class="modal-footer">
									<div class="pull-left"><button type="button" class="btn btn-default" ng-click="limpiarVisita()"><i class="fa fa-eraser"></i> Limpiar</button></div>
									<button type="button" class="btn btn-danger" ng-click="CancelaMod()" ng-show="modificaIncumplimiento">Cancelar</button>
									<button type="button" class="btn btn-info" ng-click="modificaIncump('{{expediente.id}}','{{expediente.tipoAgricultura}}')" ng-show="modificaIncumplimiento"><i class="fa fa-save"></i> Modificar</button>
									<button id="incumpButton" type="button" class="btn btn-danger pull-right" ng-click="guardarIncump('{{expediente.tipoAgricultura}}')" ng-hide="modificaIncumplimiento"><i class="fa fa-save>"></i> Guardar</button>
								</div>
							</div>
							</div>
							{% endif %}
							</div>
							{% if consultaAuditorias == 'SI' or tipoUs == 'A' %}
							
									<div class="panel panel-danger">
								<div class="panel-heading">
									<strong>Histórico Incumplimientos</strong>
								</div>
								<!-- /.panel-heading -->
								<div class="panel-body" style="max-height: 308px ;overflow-y: scroll;">
								
								
									<div class="table-responsive">

										<table class="table table-striped table-bordered table-hover">
											
											<thead>
												<tr>
													<th width="30"></th>
													<th>F. Auditoría</th>
													<th>Clasif. Inc</th>
													<th>Tipo de NC</th>
													<th>Apdo. Regl./Proced</th>
													<th>Parcelas / explotaciones / etc</th>
													<th width="30"></th>
											
												</tr>
											</thead>
											<tbody>

												<tr ng-repeat ="incumplimiento in incumplimientosVisita| filter: {id : selectAudi || '!!'}">
													<td><a href="" ng-click="editaIncumplimiento(incumplimiento.incump.id)"><i class="fa fa-edit text-info"></i></td>
													<td>[[incumplimiento.f_audi | date: 'dd/MM/yyyy']]</td>
													<td>[[tipoIncumplimiento(incumplimiento.incump.tipoIncumplimiento)]]</td>
													<td>[[tipoNoConformidad(incumplimiento.incump.tipoNoConf)]]</td>
													<td>[[incumplimiento.incump.reglproced]]</td>
													<td>[[incumplimiento.incump.parcelas]]</td>
													<td>
														<a href="" ng-click="eliminarVisita(incumplimiento.incump.id,4)"><i class="fa fa-trash-o text-danger"></i></a>
													</td>
												</tr>
						
											</tbody>
										</table>
									</div>
									
								</div>
									</div>
									<p class="text-danger">Cuando se modifica o eliminar necesito actualizar la lista. Mientras tanto actualizar página y se verán los cambios</p>
									{% endif %}
							</div>
							<div role="tabpanel" class="tab-pane" id="InformeVisita">
								<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
								<div class="panel panel-default">
									<div class="panel-heading" role="tab" id="headingOne">
										
										<h4 class="panel-title">
											<a ng-hide="modificaInforme" data-toggle="collapse" href="" data-target="#NuevoInforme" aria-expanded="false" aria-controls="NuevoInforme">
												<i class="fa fa-plus-circle"></i> 4. Nuevo Informe de Visita	
											</a>
											<a ng-show="modificaInforme" data-toggle="collapse" href="" data-target="#NuevoInforme" aria-expanded="false" aria-controls="NuevoInforme">
												<i class="fa fa-plus-circle"></i> 4. Modifica Informe de Visita	
											</a>
										</h4>
									</div>
									<div class="collapse" id="NuevoInforme">
										<div class="panel-body">
										<div class="row">
											<form id="formularioInforme"class="css-form" name="formularioInforme" role="form" action="." method="POST">{% csrf_token %}
												<div class="col-lg-4">
												<div class="form-group">
													<label>Auditoría*</label>
													{% if tipoUs == 'A' %}
													<select class="form-control" name="selectAudi" ng-model="selectAudi" ng-change="cambiaAuditoria('{{auditor.id}}')" required>
														<option  selected="true" style="display:none;" value="">Selecciona auditoría</option>
														<option ng-repeat ="auditoria in auditoriasAuditor| orderBy:'-f_Auditoria'" value="[[auditoria.id]]">[[auditoria.f_Auditoria| date: 'dd/MM/yyyy']]</option>
													</select>
													{% else %}
													<select class="form-control" name="selectAudi" ng-model="selectAudi" ng-change="cambiaAuditoria()" required>
														<option value="">Selecciona auditoría</option>
														<option ng-repeat ="auditoria in auditorias| orderBy:'-f_Auditoria'" value="[[auditoria.id]]">[[auditoria.f_Auditoria| date: 'dd/MM/yyyy']]</option>
													</select>
													{% endif %}
												</div>
											</div>	
											<div class="col-lg-2">
												<div class="form-group">
													<label>Nº Informe*</label>
													<input id="n_inf" class="form-control" name="n_inf" ng-model="n_inf">
												</div>
											</div>
											<div class="col-lg-6">
												<div class="form-group">
													<label>Equipo Auditor</label>
													<input id="equipo" class="form-control" name="equipo" ng-model="equipo">
												</div>
											</div>
											
											
											<div class="col-lg-4">
												
												<label>Añadir Fecha</label>
												<div class="input-group">
													<input id="faudi" type="date" class="form-control" name="faudi" ng-model="faudi">
													  <span class="input-group-btn">
														<button class="btn btn-default" type="button" ng-click="anadeFecha()"><i class="fa fa-plus-circle"></i></button>
													  </span>
												</div>
												
												<div class="table-responsive">

													<table class="table table-striped table-bordered table-hover">
														
														<thead>
															<tr>
																<th class="text-center">Fechas de la Auditoría</th>
																<th width="30"></th>
															</tr>
														</thead>
														<tbody>

															<tr>
																<td class="text-center">[[fechaAudi | date: 'dd/MM/yyyy']]</td>
																<td>
																</td>
															</tr>
															<tr ng-repeat="fech in fechasAuditoria">
																<td class="text-center">[[fech.fecha | date: 'dd/MM/yyyy']]</td>
																<td>
																	<a href="" ng-click="eliminaFA(fech.id)"><i class="fa fa-trash-o text-danger"></i></a>
																</td>
															</tr>
															
															
									
														</tbody>
													</table>
												</div>
											</div>
											<div class="col-lg-4">
												
												<label>Añadir Auditor</label>
												<div class="input-group">
													<input id="Nuevoauditor" class="form-control" name="Nuevoauditor" ng-model="Nuevoauditor">
													  <span class="input-group-btn">
														<button class="btn btn-default" type="button" ng-click="anadeAuditor()"><i class="fa fa-plus-circle"></i></button>
													  </span>
												</div>
												
												<div class="table-responsive">

													<table class="table table-striped table-bordered table-hover">
														
														<thead>
															<tr>
																<th class="text-center">Auditores</th>
																<th width="30"></th>
															</tr>
														</thead>
														<tbody>

															<tr>
																<td class="text-center">[[nombreAuditor]]</td>
																<td>
																</td>
															</tr>
															
															<tr ng-repeat="audit in auditoresExtra">
																<td class="text-center">[[audit.audit]]</td>
																<td>
																	<a href="" ng-click="eliminAD(audit.id)"><i class="fa fa-trash-o text-danger"></i></a>
																</td>
															</tr>
															
									
														</tbody>
													</table>
												</div>
											</div>
											<div class="col-lg-4">
												
												<label>Añadir Observador</label>
												<div class="input-group">
													<input id="Nuevobservador" class="form-control" name="Nuevobservador" ng-model="Nuevobservador">
													  <span class="input-group-btn">
														<button class="btn btn-default" type="button" ng-click="anadeObservador()"><i class="fa fa-plus-circle"></i></button>
													  </span>
												</div>
												
												<div class="table-responsive">

													<table class="table table-striped table-bordered table-hover">
														
														<thead>
															<tr>
																<th class="text-center">Observadores</th>
																<th width="30"></th>
															</tr>
														</thead>
														<tbody>

															<tr ng-repeat="observador in observadores">
																<td class="text-center">[[observador.observ]]</td>
																<td>
																	<a href="" ng-click="eliminOB(observador.id)"><i class="fa fa-trash-o text-danger"></i></a>
																</td>
															</tr>
															
									
														</tbody>
													</table>
												</div>
											</div>
											<div class="col-lg-12">
												<div class="form-group">
													<label>Reglamentación Específica</label>
													<textarea class="form-control" rows="5" ng-model="reglamento"></textarea>
												</div>
											</div>
											
											<div class="col-lg-12">
												<div class="form-group">
													<label>Verificación de corrección de incumplimientos pendientes de auditorías anteriores</label>
													<textarea class="form-control" rows="2" ng-model="verificacion"></textarea>
												</div>
											</div>
											<div class="col-lg-12">
												<div class="form-group">
													<label>Modificaciones en el alcance de la certificación (actividades,productos,emplazamientos,...)</label>
													<textarea class="form-control" rows="2" ng-model="modificacion"></textarea>
												</div>
											</div>
											<div class="col-lg-12">
												
												<label>Añadir Excusado</label>
												<div class="input-group col-lg-6">
													
													<input id="excusado" class="form-control" width="48" placeholder="Nombre excusado" name="excusado" ng-model="excusado">
													<span class="input-group-btn">
														<button class="btn btn-default" type="button" ng-click="anadeExcusado()"><i class="fa fa-plus-circle"></i></button>
													</span>
												</div>
												
												<div class="table-responsive">

													<table class="table table-striped table-bordered table-hover">
														
														<thead>
															<tr>
																<th class="text-center">Excusado</th>
																<th class="text-center">Motivo</th>
																<th width="30"></th>
															</tr>
														</thead>
														<tbody>

															<tr ng-repeat="excusado in excusados">
																<td class="text-center">[[excusado.nombre]]</td>
																<td><input id="motivo[[excusado.id]]" class="form-control" placeholder="Motivo" name="motivo" ng-model="excusado.motivo"></td>
																<td>
																	<a href="" ng-click="eliminEX(excusado.id)"><i class="fa fa-trash-o text-danger"></i></a>
																</td>
															</tr>
															
									
														</tbody>
													</table>
												</div>
											</div>
									
										</form>
										</div>
									</div>
									<div class="modal-footer">
										<button ng-hide="modificaInforme" type="button" class="btn btn-info pull-right" ng-click="creaInforme()"><i class="fa fa-save"></i> Guardar</button>
										<button ng-show="modificaInforme" type="button" class="btn btn-danger" ng-click="CancelaInf()" >Cancelar</button>
										<button ng-show="modificaInforme" type="button" class="btn btn-info" ng-click="modInforme()"><i class="fa fa-save"></i> Modificar</button>
									</div>
								</div>
								</div>
							</div>
							<div class="panel panel-default">
							
								<div class="panel-heading">
									<strong>Informes de Visita</strong>
								</div>
								<!-- /.panel-heading -->
								<div class="panel-body" style="max-height: 308px ;overflow-y: scroll;">
							
									<div class="table-responsive">

										<table class="table table-striped table-bordered table-hover">
											
											<thead>
												<tr>
													<th width="30"></th>
													<th>Fecha Auditoria</th>
													<th>Nº Informe</th>
													<th>Auditor</th>
													<th width="30"></th>
													<th width="30"></th>
												</tr>
											</thead>
											<tbody>
												
												<tr ng-repeat="informe in informesVisita | filter: {id : selectAudi || '!!'}| orderBy:'-inform.num_informe'">
													<td><a href="" ng-click="editaInforme(informe.inform.id)"><i class="fa fa-edit text-info"></i></td>
													<td>[[informe.inform.f_Auditoria | date: 'dd/MM/yyyy']]</td>
													<td>[[informe.inform.num_informe]]</td>
													<td>[[informe.inform.nombreIns]] [[informe.inform.apellido1Ins]] [[informe.inform.apellido2Ins]]</td>
													<td>
														<a href="/Auditorias/[[informe.inform.id]]/generaInforme/" ><i class="fa fa-download" title="Generar Informe"></i></a>
													</td>
													<td>
														<a href="" ng-click="eliminarInforme(informe.inform.id)"><i class="fa fa-trash-o text-danger"></i></a>
													</td>
												</tr>
												
						
											</tbody>
										</table>
									</div>
									
								</div>

							</div>
							</div>
							<div role="tabpanel" class="tab-pane" id="Acciones">
							
							{% if creaAuditorias == 'SI' or tipoUs == 'A'%}

								<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
								<div class="panel panel-success">
									<div class="panel-heading" role="tab" id="headingOne">
										
										<h4 class="panel-title">
											<a ng-hide="modificaAcciones" data-toggle="collapse" href="" data-target="#AccionesCorrectivas" aria-expanded="false" aria-controls="AccionesCorrectivas">
												<i class="fa fa-plus-circle"></i> 4. Modifica Acciones Correctivas	
											</a>
											<a ng-show="modificaAcciones" data-toggle="collapse" href="" data-target="#AccionesCorrectivas" aria-expanded="false" aria-controls="AccionesCorrectivas">
												<i class="fa fa-plus-circle"></i> 4. Acciones Correctivas
											</a>
										</h4>
									</div>
									<div class="collapse" id="AccionesCorrectivas">
										<div class="panel-body">
										<div class="row">
										<form id="formularioVisita"class="css-form" name="formularioVisita" role="form" action="." method="POST">{% csrf_token %}
												
											<div class="col-lg-3">
												<div class="form-group">
													<label>Auditoría*</label>
													{% if tipoUs == 'A' %}
													<select class="form-control" name="selectAudi" ng-model="selectAudi" ng-change="cambiaAuditoria('{{auditor.id}}')" required>
														<option  selected="true" style="display:none;" value="">Selecciona auditoría</option>
														<option ng-repeat ="auditoria in auditoriasAuditor| orderBy:'-f_Auditoria'" value="[[auditoria.id]]">[[auditoria.f_Auditoria| date: 'dd/MM/yyyy']]</option>
													</select>
													{% else %}
													<select id="selectAudi" class="form-control" name="selectAudi" ng-model="selectAudi" ng-change="cambiaAuditoria()" required>
														<option  selected="true" value="">Selecciona auditoría</option>
														<option ng-repeat ="auditoria in auditorias| orderBy:'-f_Auditoria'" value="[[auditoria.id]]">[[auditoria.f_Auditoria| date: 'dd/MM/yyyy']]</option>
													</select>
													{% endif %}
												</div>
											</div>	
											<div class="col-lg-6" ng-hide="solPAC">
												<div class="form-group">
													<label></label>
													<p><strong>[[precisa]]</strong></p>
												</div>
											</div>
											<div class="col-lg-4" ng-show="solPAC">
												<div class="form-group">
													<label>Fecha de recepción PAC*</label>
													<input id="fPAC" type="date" class="form-control" name="fPAC" ng-model="fPAC" required>
												</div>
											</div>
											<div class="col-lg-4" ng-show="solPAC">
												<div class="form-group">
													<label>Fecha de ampliación de PAC</label>
													<input id="fAMPAC" type="date" class="form-control" name="fAMPAC" ng-model="fAMPAC">
												</div>
											</div>
												<div class="col-lg-12" ng-show="solPAC">
													</br>
													<div class="form-group">
														<label class="text-danger">¿Da respuesta a todas las incidencias detectadas?*</label></br>
														<div class="col-lg-3">
															&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" value='SI' ng-model="preg1"> <strong>SI</strong>
															&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" value='NO' ng-model="preg1"> <strong>NO</strong>
														</div>
														<div class="col-lg-9">
															<label>Comentarios</label>
															<textarea class="form-control" rows="3" ng-model="descp1"></textarea>
														</div>
													</div>
													
												</div>
												<div class="col-lg-12" ng-show="solPAC">
													</br>
													<div class="form-group">
														<label class="text-danger">¿Identifica las causas de las No Conformidades?*</label></br>
														<div class="col-lg-3">
															&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" value='SI' ng-model="preg2"> <strong>SI</strong>
															&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" value='NO' ng-model="preg2"> <strong>NO</strong>
														</div>
														<div class="col-lg-9">
															<label>Comentarios</label>
															<textarea class="form-control" rows="3" ng-model="descp2"></textarea>
														</div>
													</div>
													
												</div>
												<div class="col-lg-12" ng-show="solPAC">
													</br>
													<div class="form-group">
														<label class="text-danger">¿Indica plazos de implantación y responsables?*</label></br>
														<div class="col-lg-3">
															&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" value='SI' ng-model="preg3"> <strong>SI</strong>
															&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" value='NO' ng-model="preg3"> <strong>NO</strong>
														</div>
														<div class="col-lg-9">
															<label>Comentarios</label>
															<textarea class="form-control" rows="3" ng-model="descp3"></textarea>
														</div>
													</div>
													
												</div>
												<div class="col-lg-12" ng-show="solPAC">
													</br>
													<div class="form-group">
														<label class="text-danger">¿Incluye evidencias de la implantación?*</label></br>
														<div class="col-lg-3">
															&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" value='SI' ng-model="preg4"> <strong>SI</strong>
															&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" value='NO' ng-model="preg4"> <strong>NO</strong>
														</div>
														<div class="col-lg-9">
															<label>Comentarios</label>
															<textarea class="form-control" rows="3" ng-model="descp4"></textarea>
														</div>
													</div>
													
												</div>	
											</form>
									</div>
								</div>
								<div class="modal-footer" ng-show="solPAC">
									<div class="pull-left"><button type="button" class="btn btn-default" ng-click="limpiarVisita()"><i class="fa fa-eraser"></i> Limpiar</button></div>
									<button type="button" class="btn btn-success pull-right" ng-click="guardarAcciones()" ng-hide="muestraAcciones"><i class="fa fa-save"></i> Guardar</button>
									<button type="button" class="btn btn-success pull-right" ng-click="modificaAcciones()" ng-show="muestraAcciones"><i class="fa fa-save"></i> Modificar</button>
									
								</div>
							</div>
						</div>
					</div>
					<div class="panel panel-success">
							
								<div class="panel-heading">
									<strong>Acciones Correctivas Evaluadas</strong>
								</div>
								<!-- /.panel-heading -->
								<div class="panel-body" style="max-height: 308px ;overflow-y: scroll;">
							
									<div class="table-responsive">

										<table class="table table-striped table-bordered table-hover">
											
											<thead>
												<tr>
													<th width="30"></th>
													<th>Fecha Auditoria</th>
													<th>Fecha PAC</th>
													<th>Solicita AMPAC</th>
													<th width="30"></th>
												</tr>
											</thead>
											<tbody>
												
												<tr ng-repeat="accion in accionesCorrect">
													<td><!--<a href="" ng-click="editaAccionCorrectiva(accion.id)"><i class="fa fa-edit text-info"></i>--></td>
													<td>[[accion.f_audi| date: 'dd/MM/yyyy']]</td>
													<td>[[accion.acc.f_pac | date: 'dd/MM/yyyy']]</td>
													<td>[[accion.acc.f_ampac | date: 'dd/MM/yyyy']]</td>
													<td><!--
														<a href="" ng-click="eliminarAccion(accion.acc.id)"><i class="fa fa-trash-o text-danger"></i>--></a>
													</td>
												</tr>
												
						
											</tbody>
										</table>
									</div>
									
								</div>

							</div>

							{% endif %}
						</div>
						<div role="tabpanel" class="tab-pane" id="Evaluacion">
						{% if creaAuditorias == 'SI' or tipoUs == 'A'%}
							<div class="panel panel-info">
								<div class="panel-heading">
									<h4 class="panel-title">
										6. Informe de Evaluación
									</h4>
								</div>
								<div class="panel-body">
									<div class="table-responsive">

										<table class="table table-striped table-bordered table-hover">
											
											<thead>
												<tr>
													<th width="250">OPERADOR:</th>
													<th>{{expediente.id_cliente}}</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>AUDITORÍA/INSPECCIÓN:</td>
													<td>{{expediente.CodOperador}}</td>
												</tr>
												<tr>
													<td>FECHA AUDITORÍA:</td>
													<td>{% if tipoUs == 'A'%}
														<select style="width:200px;" class="form-control" name="selectAudi" ng-model="selectAudi" ng-change="cambiaAuditoria('{{auditor.id}}')" required>
															<option  selected="true" style="display:none;" value="">Selecciona auditoría</option>
															<option ng-repeat ="auditoria in auditoriasAuditor| orderBy:'-f_Auditoria'" value="[[auditoria.id]]">[[auditoria.f_Auditoria| date: 'dd/MM/yyyy']]</option>
														</select>
														{% else %}
														<select style="width:200px;"  class="form-control" name="selectAudi" ng-model="selectAudi" ng-change="cambiaAuditoria()" required>
															<option  selected="true" style="display:none;" value="">Selecciona auditoría</option>
															<option ng-repeat ="auditoria in auditorias| orderBy:'-f_Auditoria'" value="[[auditoria.id]]">[[auditoria.f_Auditoria| date: 'dd/MM/yyyy']]</option>
														</select>
														{% endif %}
													</td>
												</tr>
												<tr ng-show="solPAC">
													<td>FECHA RECEPCIÓN PAC:</td>
													<td>[[fPAC | date: 'dd/MM/yyyy']] [[ampac]] [[fAMPAC | date: 'dd/MM/yyyy']]</td>
												</tr>
												<tr>
													<td>FECHA DE EVALUACIÓN:</td>
													<td><input style="width:200px;" id="fEV" type="date" class="form-control" name="fEV" ng-model="fEV" required></td>
												</tr>
												<tr>
													<td>EVALUACIÓN REALIZADA POR:</td>
													<td>{% if tipoUs == 'A'%}
														{{auditor}}
														{% else %}
														<select style="width:200px;" class="form-control" name="inspector" ng-model="inspector2" required>
															<option  selected="true" style="display:none;" value="">Selecciona Inspector</option>
															{% for inspector in auditores %}
															<option value="{{inspector.id}}">{{inspector.Nombre}} {{inspector.Apellido1}} {{inspector.Apellido2}}</option>
															{% endfor %}
														</select>
														{% endif %}</td>
												</tr>
						
											</tbody>
										</table>
									</div>
									
									<div class="table-responsive" ng-show="solPAC">

										<table class="table table-striped table-bordered table-hover">
											
											<thead>
												<tr>
													<th width="400">PAC CUMPLIMENTADO CORRECTAMENTE(SI/NO):</th>
													<th>[[cumplimentado]]</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>¿Da respuesta a todas las incidencias detectadas?</td>
													<td>[[preg1]]</td>
												</tr>
												<tr>
													<td>¿Identifica las causas de las No Conformidades?</td>
													<td>[[preg2]]</td>
												</tr>
												<tr>
													<td>¿Indica plazos de implantación y responsables?</td>
													<td>[[preg3]]</td>
												</tr>
												<tr>
													<td>¿Incluye evidencias de la implantación?</td>
													<td>[[preg4]]</td>
												</tr>
						
											</tbody>
										</table>
									</div>
									
									<div class="table-responsive" ng-hide="solPAC">
										<h3 class="text-success"><strong>[[PAC]]</strong></h3>
										<p>[[descripcionPAC]]</p>
									</div>
									
									<div class="table-responsive" ng-show="incumplimientos">

										<table class="table table-striped table-bordered table-hover">
											
											<thead>
												<tr>
													<th width="15" class="text-center">Ref. Inc.</th>
													<th width="20" class="text-center">Clasif. Inc.</th>
													<th>REQUISITO</th>
													<th>Apdo. Regl./Proced.</th>
													<th>Parcelas/ explotaciones/ producto con incumplimiento</th>
													<th>OBSERVACIONES</th>
												</tr>
											</thead>
											<tbody>
												<tr ng-repeat ="incumplimiento in incumplimientos">
													<td>[[incumplimiento.ref]]</td>
													<td class="text-center">[[incumplimiento.tipoIncumplimiento]]</td>
													<td>[[incumplimiento.incumplimiento]]</td>
													<td>[[incumplimiento.reglproced]]</td>
													<td>[[incumplimiento.parcelas]]</td>
													<td>[[incumplimiento.observaciones]]</td>
												</tr>
						
											</tbody>
										</table>
									</div>
									<div class="col-lg-12">
										</br>
										<div class="form-group">
											<div class="col-lg-3">
											<label>RESULTADO DE LA EVALUACIÓN*</label></br>
											</div>
											<div class="col-lg-6">
											<select style="width:170px;" class="form-control" name="resultado" ng-model="resultado" required>
												<option value="N" class="text-danger">NO CONFORME</strong></option>
												<option value="S" class="text-success">CONFORME</option>
											</select>
											</div>
										</div>
													
									</div>	
								</div>
								<div class="modal-footer">
									{% if tipoUs == 'A'%}
										<button type="button" class="btn btn-info pull-right" ng-click="guardarEvaluacion('{{auditor.id}}')" ng-hide="muestraEvaluacion"><i class="fa fa-save"></i> Guardar</button>
										<button type="button" class="btn btn-info pull-right" ng-click="modificaEvaluacion('{{auditor.id}}')" ng-show="muestraEvaluacion"><i class="fa fa-save"></i> Modificar</button>
									{% else %}
										<button type="button" class="btn btn-info pull-right" ng-click="guardarEvaluacion(inspector2)" ng-hide="muestraEvaluacion"><i class="fa fa-save"></i> Guardar</button>
										<button type="button" class="btn btn-info pull-right" ng-click="modificaEvaluacion(inspector2)" ng-show="muestraEvaluacion"><i class="fa fa-save"></i> Modificar</button>
									{% endif %}
									
								</div>
							</div>
							{% endif %}
						</div>
						<div role="tabpanel" class="tab-pane" id="Certificacion">
						
						<div class="panel panel-primary">
								<div class="panel-heading">
									<h4 class="panel-title">
										7. Certificación
									</h4>
								</div>
								<div class="panel-body">
									<div class="row">
										<div class="col-lg-3">
											<div class="form-group">
												<label>Auditoría*</label>
												<select class="form-control" name="selectAudi" ng-model="selectAudi" ng-change="cambiaAuditoria()" required>
													<option  selected="true" style="display:none;" value="">Selecciona auditoría</option>
													<option ng-repeat ="auditoria in auditorias| orderBy:'-f_Auditoria'" value="[[auditoria.id]]">[[auditoria.f_Auditoria| date: 'dd/MM/yyyy']]</option>
												</select>
											</div>
										</div>
										<div class="col-lg-9">
											<label class="text-info">PROGRESO PARA CERTIFICACIÓN</label>
												<div id="barraProgreso" class="progress">
													  <div id="textProgreso2"class="progress-bar progress-bar-info progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
														0%
													  </div>
												</div>
										</div>
										
										<div class="col-lg-12">
										</div>
										
										<div class="col-lg-2" ng-show="certificado">
											<div class="form-group">
												<label>Certificado*</label>
												<select id="vigente" class="form-control" name="vigente" ng-model="vigent" ng-change="cambiaFecha()" required>
													<option value="SI">SI</option>
													<option value="NO">NO</option>
												</select>
											</div>
										</div>
										
										<div class="col-lg-4" ng-show="vigent == 'NO' && haestadovigente == 'SI'">
											<div class="form-group">
												<label class="text-danger">Última vigencia:</label> 
												<div class="text-danger">{{expediente.F_iniciovigencia}} / {{expediente.F_finalvigencia}}</div>
											</div>
										</div>
										
										<div class="col-lg-4 has-success" ng-show="est == 'ALTA' && vigent == 'SI' && certificado" >
											<div class="form-group">
												<label class="control-label" for="inputSuccess1">Fecha de Inicio de Vigencia*</label>
												<input id="fechaInicio" type="date" class="form-control" name="fechaInicio" ng-model="fechaInicio" ng-change="cambiaFecha()"required>
											</div>
										</div>
										
										<div class="col-lg-4 has-success" ng-show="est == 'ALTA' && vigent == 'SI' && certificado">
											<div class="form-group">
												<label class="control-label" for="inputSuccess1">Fecha Fin de Vigencia*</label>
												<input id="fechaFin" type="date" class="form-control" name="fechaFin" ng-model="fechaFin" ng-change="cambiaFecha()" required>
											</div>
										</div>
										
									</div>
								</div>
								<div class="modal-footer">
									<button id="botoncertificar" type="button" class="btn btn-info pull-right" ng-click="certificar('{{expediente.id}}')" disabled ng-hide="modificaCertificado"><i class="fa fa-save"></i> Certificar</button>
									<button id="botoncertificar2" type="button" class="btn btn-info pull-right" ng-click="modificaCertif('{{expediente.id}}')" ng-show="modificaCertificado"><i class="fa fa-save"></i> Modificar Certificado</button>
								</div>
							</div>
							<div class="panel panel-primary">
								<div class="panel-heading">
									<h4 class="panel-title">
										Histórico Certificación
									</h4>
								</div>
								<div class="panel-body" style="max-height: 308px ;overflow-y: scroll;">
									<div class="table-responsive">

										<table class="table table-striped table-bordered table-hover">
											
											<thead>
												<tr>
													<th>Inicio de Vigencia</th>
													<th>Fin de Vigencia</th>
												</tr>
											</thead>
											<tbody>

												<tr ng-repeat ="certificado in certificados | orderBy:'-F_finalvigencia'">
													<td>[[certificado.F_iniciovigencia  | date: 'dd/MM/yyyy']]</td>
													<td>[[certificado.F_finalvigencia  | date: 'dd/MM/yyyy']]</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
						<div role="tabpanel" class="panel panel-success tab-pane" id="Visit">
						
							<div class="panel-heading">
								<h4 class="panel-title">
									<strong>8. Visitas Completadas</strong>
								</h4>
							</div>
							<div class="panel-body" style="max-height: 308px ;overflow-y: scroll;">
								<div class="table-responsive">

									<table class="table table-striped table-bordered table-hover">
										
										<thead>
											<tr>
												<!--<th width="30"></th>-->
												<th width="150">Fecha de visita</th>
												<th>Inspector</th>
												<th>Actuación</th>
												<th>Informe de Visita</th>
												<th width="30"></th>
										
											</tr>
										</thead>
										<tbody>
											<tr ng-repeat ="visita in visitas| orderBy:'-f_visita'">
												<!--<td><a href="" ng-click="editaVisita('[[visita.id]]')"><i class="fa fa-edit text-info"></i></td>-->
												<td>[[visita.f_visita | date: 'dd/MM/yyyy']]</td>
												<td>[[visita.nombreIns]] [[visita.apellido1Ins]] [[visita.apellido2Ins]]</td>
												<td>[[visita.actuacion]]</td>
												<td></td>
												<td>
													{% if modificaRealizadas == 'SI'%}<a href="" ng-click="eliminarVisita(visita.id,1)"><i class="fa fa-trash-o text-danger"></i></a>{% endif %}
												</td>
											</tr>

					
										</tbody>
									</table>
								</div>
					
							</div>
							
						</div>
						
						
						
						</div>
				</div>
				<div role="tabpanel" class="tab-pane" id="Riesgos">
					
					<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">

						<div class="panel panel-info">
							<div class="panel-heading" role="tab" id="headingOne">
								<h4 class="panel-title">
									{% if creaRiesgos == 'SI' %}
									<div ng-hide="modificaRiesgo">
										<a data-toggle="collapse" href="" data-target="#nuevaEvaluacion" aria-expanded="false" aria-controls="nuevaEvaluacion">
											<i class="fa fa-plus-circle"></i> Iniciar Evaluación
										</a>
									</div>
									{% endif %}
									<div ng-show="modificaRiesgo">
										<a data-toggle="collapse" href="" data-target="#nuevaEvaluacion" aria-expanded="false" aria-controls="nuevaEvaluacion">
											<i class="fa fa-plus-circle"></i> Modificar Evaluación
										</a>
									</div>
								
								
									
								</h4>
							</div>
							<div class="collapse" id="nuevaEvaluacion">
								<div class="panel-body">
									<div class="row" >
										<form id="formularioEvaluacion"class="css-form" name="formularioEvaluacion" role="form" action="." method="POST">{% csrf_token %}
											<div class="col-lg-2">
												<div class="form-group">
													<label class="control-label">Fecha de evaluación</label>
													<input id="f_eval" type="date" class="form-control" name="f_eval" ng-model="f_eval" ng-change="evalua()" required>
												</div>
											</div>
											<div class="col-lg-12">
												<div class="col-lg-8">
													<div class="form-group">
														<label class="text-danger">I. VINCULACIÓN CON LA SUSPENSIÓN O RETIRADA</label>
														<p>&nbsp;&nbsp;&nbsp;El operador mantiene vinculación con otros operadores con la certificación suspendida o retirada</p>
													</div>
												</div>
												<div class="col-lg-1">
													<label></label>
													<select id="vinc_s_r" class="form-control" name="vinc_s_r" ng-model="vinc_s_r" ng-change="evalua()" required>
														<option value="S">SI</option>
														<option value="N">NO</option>
													</select>
												</div>
											</div>
											<div class="col-lg-12">
												<div class="col-lg-8">
													<div class="form-group">
														<label class="text-danger">II. ALCANCES CERTIFICADOS</label>
														<p>&nbsp;&nbsp;&nbsp;El operador tiene distintos alcances certificados por más de un organismo de control</p>
													</div>
												</div>
												<div class="col-lg-1">
													<label></label>
													<select id="alc_cert" class="form-control" name="alc_cert" ng-model="alc_cert" ng-change="evalua()"required>
														<option value="S">SI</option>
														<option value="N">NO</option>
													</select>
												</div>
											</div>
											<div class="col-lg-12">
												<div class="col-lg-8">
													<div class="form-group">
														<label class="text-danger">III. NO CONFORMIDADES</label>
														<p>&nbsp;&nbsp;&nbsp;Se detectan irregularidades o infracciones que afectan de forma directa a las características del producto</p>
													</div>
												</div>
												<div class="col-lg-1">
													<label></label>
													<select id="no_conf" class="form-control" name="no_conf" ng-model="no_conf" ng-change="evalua()" required>
														<option value="S">SI</option>
														<option value="N">NO</option>
													</select>
												</div>
											</div>

											<div class="col-lg-12">
												<div class="form-group">
													<label class="text-info col-lg-6">I. APLICACIÓN DIRECTA DE CONTAMINANTES</label>
													<div class="col-lg-7">
														<div class="col-lg-12">
															<input type="radio" value=0 ng-model="radio1" ng-change="evalua()"> <strong>No emplea insumos</strong> ni mat.primas</br>
															<input type="radio" value=1 ng-model="radio1" ng-change="evalua()"> Sólo emplea insumos o mat.primas <strong>certificadas</strong></br>
															<input type="radio" value=2 ng-model="radio1" ng-change="evalua()"> Emplea insumos o mat.primas <strong>sin certificar</strong></br>
															<input type="radio" value=3 ng-model="radio1" ng-change="evalua()"> Emplea insumos o mat.primas de <strong>dudoso origen o composición</strong>				
														</div>
													</div>
												</div>
											</div>
											
											<div class="col-lg-12">
												</br>
												<div class="form-group">
													<label class="text-info col-lg-6">II. APLICACIÓN INDIRECTA DE CONTAMINANTES</label>
													<div class="col-lg-10">
														<div class="col-lg-12">
															<input type="radio" value=0 ng-model="radio2" ng-change="evalua()"> <strong>No emplea insumos</strong> ni mat.primas</br>
															<input type="radio" value=1 ng-model="radio2" ng-change="evalua()"> Sólo emplea insumos o mat.primas <strong>certificadas o sin riesgo de contaminación</strong> por su composición u origen</br>
															<input type="radio" value=2 ng-model="radio2" ng-change="evalua()"> Emplea insumos o mat.primas <strong>sin certificar o sin riesgo de contaminación</strong> por su composición u origen</br>
															<input type="radio" value=3 ng-model="radio2" ng-change="evalua()"> Emplea insumos o mat.primas de <strong>dudoso origen o composición</strong>				
														</div>
													</div>
												</div>
											</div>
											<div class="col-lg-12">
												</br>
												<div class="form-group">
													<label class="text-info col-lg-6">III. ENTORNO DE PRODUCCIÓN</label>
													<div class="col-lg-12">
														<div class="col-lg-12">
															<input type="radio" value=0 ng-model="radio3" ng-change="evalua()"> El entorno de la zona de cultivo, de cría o de pecoreo es <strong>silvestre o ecológico</strong>.</br>
															<input type="radio" value=1 ng-model="radio3" ng-change="evalua()"> La zona de cultivo, de cría, de pecoreo, están rodeadas de </strong>zonas no ecológicas</strong> pero con una <strong>distancia suficiente</strong>.</br> 
																										   En las instalaciones manipula producción no ecológica pero existe separación física total.</br>
															<input type="radio" value=2 ng-model="radio3" ng-change="evalua()"> La zona de cultivo, de cría, de pecoreo, están rodeadas de <strong>zonas no ecológicas</strong> con una <strong>distancia insuficiente</strong>.</br>
																										   En las instalaciones manipula producción no ecológica pero existe separación temporal pero con <strong class="text-success">fácil limpieza</strong>.</br>
															<input type="radio" value=3 ng-model="radio3" ng-change="evalua()"> La zona de cultivo, de cría, de pecoreo, están rodeadas de <strong>zonas no ecológicas</strong> con una <strong>distancia insuficiente</strong>.</br>				
														                                                   En las instalaciones manipula producción no ecológica pero existe separación temporal y de <strong class="text-danger">difícil limpieza</strong>.
														</div>
													</div>
												</div>
											</div>
											<div class="col-lg-12">
												</br>
												<div class="form-group">
													<label class="text-info col-lg-6">IV. PRODUCCIÓN PARALELA</label>
													<div class="col-lg-12">
														<div class="col-lg-12">
															<input type="radio" value=0 ng-model="radio4" ng-change="evalua()"> <strong>Toda la producción</strong> de un mismo cultivo, ganado o producto se encuentra en <strong>producción ecológica o en conversión</strong>.</br>
																										   No lindan con zonas de producción de la misma especie o ganado no ecológicos.</br>
																										   En la explotación no existen cultivos animales o colmenas de otro operador.</br>
																										   No se manipula producción convencional</br>
															<input type="radio" value=1 ng-model="radio4" ng-change="evalua()"> Produce producción ecológica, no ecológica y en conversión de un mismo cultivo o ganado pero en <strong>diferentes unidades de producción</strong>.</br>
																										   Manipula producto ecológico, no ecológico y en conversión con total separación física.</br>
															<input type="radio" value=2 ng-model="radio4" ng-change="evalua()"> Produce producción ecológica, no ecológica y en conversión de un mismo cultivo, ganado o producto en una <strong>misma unidad de producción</strong> o linda con cultivos o ganado del mismo tipo pero con <strong class="text-success">separación física</strong></br>
																										   Manipula en sus instalaciones producción ecológica, no ecológica y en conversión con separación en parte física y en parte temporal.</br>
															<input type="radio" value=3 ng-model="radio4" ng-change="evalua()"> Tienen producción ecológica, no ecológica o en conversión de un mismo cultivo o ganado en una <strong>misma unidad de producción</strong>.</br>
																										   Las zonas de cultivo, los animales y colmenas no lindan con otros no ecológicos de la misma especie o ganado.</br>
																										   En la finca hay cultivos o ganado del mismo tipo pero de otro operador ecológico.</br>
																										   Manipula producción ecológica, no ecológica y en conversión con <strong class="text-danger">separación temporal</strong>.
														</div>
													</div>
												</div>
											</div>
											<div class="col-lg-12">
												</br>
												<div class="form-group">
													<label class="text-info col-lg-6">V. UTILIZACIÓN DE ELEMENTOS CONTAMINADOS</label>
													<div class="col-lg-12">
														<div class="col-lg-12">
															<input type="radio" value=0 ng-model="radio5" ng-change="evalua()"> La maquinaria, envases, recipientes, transportes, instalaciones, equipos,...son de <strong>uso exclusivo</strong> para los productos ecológicos de la explotación o industria.</br>
															<input type="radio" value=1 ng-model="radio5" ng-change="evalua()"> La maquinaria, envases, recipientes, transportes, instalaciones, equipos,...son <strong>compartidos</strong> con otros <strong class="text-success">operadores ecológicos</strong>.</br>
															<input type="radio" value=2 ng-model="radio5" ng-change="evalua()"> La maquinaria, envases, recipientes, transportes, instalaciones, equipos,...son <strong>compartidos</strong> con otros <strong class="text-danger">operadores no ecológicos</strong>.</br>
															<input type="radio" value=3 ng-model="radio5" ng-change="evalua()"> La maquinaria, envases, recipientes, transportes, instalaciones, equipos,...son <strong>compartidos</strong> con otros <strong class="text-danger">operadores no ecológicos</strong> que utilizan productos de alto riesgo de <strong>contaminación</strong>. 
														</div>
													</div>
												</div>
											</div>
											<div class="col-lg-12">
												</br>
												<div class="form-group">
													<label class="text-info col-lg-6">VI. CONTAMINACIÓN RESIDUAL</label>
													<div class="col-lg-12">
														<div class="col-lg-12">
															<input type="radio" value=0 ng-model="radio6" ng-change="evalua()"> El manejo anterior de la finca era de <strong>abandono o realizaba agricultura ecológica</strong> desde hace más de tres años.</br>
																										   El manejo anterior de los animales y colmenas era sin realizar tratamientos desde hace más de un año.</br>
															<input type="radio" value=1 ng-model="radio6" ng-change="evalua()"> El manejo anterior de la finca era con <strong>baja utilización de insumos</strong>.</br>
																										   El manejo anterior de los animales y colmenas era de baja utilización de insumos.</br>
															<input type="radio" value=2 ng-model="radio6" ng-change="evalua()"> El manejo anterior de la finca era con <strong>alta utilización de insumos</strong>.</br>
																										   El manejo anterior de los animales y colmenas era de alta utilización de insumos.</br>
															<input type="radio" value=3 ng-model="radio6" ng-change="evalua()"> El manejo anterior de la finca era con utilización de <strong>insumos muy persistentes</strong>.</br>
																										   El manejo anterior de los animales y colmenas era con utilización de insumos persistentes.
																											
														</div>
													</div>
												</div>
											</div>
											<div class="col-lg-12">
												</br>
												<div class="form-group">
													<label class="text-info col-lg-6">VII. RESULTADOS DE CONTROLES ANTERIORES</label>
													<div class="col-lg-12">
														<div class="col-lg-12">
															<input type="radio" value=0 ng-model="radio7" ng-change="evalua()"> Sin No conformidades y <strong>sin desviaciones</strong></br>
															<input type="radio" value=2 ng-model="radio7" ng-change="evalua()"> Sin No conformidades pero <strong>con desviaciones</strong></br>
															<input type="radio" value=4 ng-model="radio7" ng-change="evalua()"> Con irregularidades</br>
															<input type="radio" value=6 ng-model="radio7" ng-change="evalua()"> Con infracciones											
														</div>
													</div>
												</div>
											</div>
											<div class="col-lg-12">
												</br>
												<div class="form-group">
													<label class="text-info col-lg-6">VIII. RIESGO DE SUSTITUCIÓN DE PRODUCTO</label>
													<div class="col-lg-12">
														<div class="col-lg-12">
															<input type="radio" value=0 ng-model="radio8" ng-change="evalua()"> <strong>Riesgo nulo</strong></br>
															<input type="radio" value=2 ng-model="radio8" ng-change="evalua()"> <strong class="text-success">Riesgo bajo</strong></br>
															<input type="radio" value=4 ng-model="radio8" ng-change="evalua()"> <strong class="text-warning">Riesgo medio</strong></br>
															<input type="radio" value=6 ng-model="radio8" ng-change="evalua()"> <strong class="text-danger">Riesgo alto</strong>											
														</div>
													</div>
												</div>
											</div>
											<div class="col-lg-12">
												</br>
												<div class="col-lg-3">
													<div class="form-group">
														<label>VOLUMEN DE PRODUCCIÓN</label>
														<input id="Volumen" class="form-control" name="Volumen" ng-model="Volumen" ng-change="evalua()">
													</div>
												</div>
											</div>
											<div class="col-lg-10">
												</br>
												<label class="text-info">PROGRESO</label>
													<div id="barraProgreso" class="progress">
													  <div id="textProgreso"class="progress-bar progress-bar-info progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
														0%
													  </div>
													</div>
											</div>
											
											<div class="col-lg-2 text-center">
												
													<div class="form-group">
													<div id="score" class="alert alert-info" role="alert">
														<label>PUNTUACIÓN FINAL</label>
														<p>[[puntuacion]]</p>
													</div>
												</div>
											</div>
										</form>
									</div>
								</div>
								<div class="modal-footer">
									<button id="myBtn" type="button" class="btn btn-success pull-right" ng-click="guardarRiesgo('{{expediente.id}}')"><i class="fa fa-save"></i> Guardar</button>
								</div>
							</div>
							
						</div>
					</div>
					{% if consultaRiesgos == 'SI' %}
					<div class="panel panel-info">
				<div class="panel-heading">
					<strong>Histórico de evaluación</strong>
				</div>
				<!-- /.panel-heading -->
				<div class="panel-body">
				
				
					<div class="table-responsive">

						<table class="table table-striped table-bordered table-hover">
							
							<thead>
								<tr>
									<th width="30"></th>
									<th>Fecha de evaluación</th>
									<th>Puntuación</th>
									<th width="30"></th>
							
								</tr>
							</thead>
							<tbody>

								<tr ng-repeat ="evaluacion in evaluaciones">
									<td>{% if modificaRiesgos == 'SI' %}<a href="" ng-click="editaRiesgo(evaluacion.id)"><i class="fa fa-edit text-info"></i>{% endif %}</td>
									<td>[[evaluacion.f_eval | date: 'dd/MM/yyyy']]</td>
									<td>[[evaluacion.puntuacion]]</td>
									<td>
										{% if modificaRiesgos == 'SI' %}<a href="" ng-click="eliminarRiesgo(evaluacion.id)"><i class="fa fa-trash-o text-danger"></i></a>{% endif %}
									</td>
								</tr>
		
							</tbody>
						</table>
					</div>
					
				</div>

			</div>
			{% endif %}
				</div>
				<div role="tabpanel" class="tab-pane" id="Facturacion">
					<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
						{% if creaFactura == 'SI' %}
						<div class="panel panel-info">
							<div class="panel-heading" role="tab" id="headingOne">
								<h4 class="panel-title">
									<a data-toggle="collapse" href="" data-target="#nuevaFactura" aria-expanded="false" aria-controls="nuevaFactura" ng-hide="modFact">
										<i class="fa fa-plus-circle"></i> Nueva Factura
									</a>
									<a data-toggle="collapse" href="" data-target="#nuevaFactura" aria-expanded="false" aria-controls="nuevaFactura" ng-show="modFact">
										<i class="fa fa-plus-circle"></i> Modifica Factura
									</a>
								</h4>
							</div>
							<div class="collapse" id="nuevaFactura">
								<div class="panel-body">
									<div class="row" >
										<form id="formularioFacturacion"class="css-form" name="FacturaForm" role="form" action="." method="POST">{% csrf_token %}
											<div class="col-lg-3">
												<div class="form-group">
													<label>Fecha de facturación*</label>
													<input id="fact" type="date" class="form-control" name="fact" ng-model="fact" required>
													<div class="error-container" ng-show="FacturaForm.fact.$dirty && FacturaForm.fact.$invalid">
														<small class="error text-danger" ng-show="FacturaForm.fact.$error.required">La fecha de facturación es requerida</small>
													</div>
												</div>
											</div>
											<div class="col-lg-9">
												<div class="form-group">
													<label>Concepto</label>
													<input id="concepto" class="form-control" name="concepto" ng-model="concepto">
												</div>
											</div>
											<div class="col-lg-4">
												<div class="form-group">
													<label>Importe</label>
													<input id="importe" class="form-control" name="importe" ng-model="importe">
												</div>
											</div>
										</form>
									</div>
								</div>
								<div class="modal-footer">
									<div class="pull-left"><button type="button" class="btn btn-default" ng-click="limpiar()">Limpiar</button></div>
									<button type="button" class="btn btn-info" ng-click="creaFactura('{{expediente.id}}')" ng-hide="modFact">Guardar</button>
									<button type="button" class="btn btn-info" ng-click="editaFactura('{{expediente.id}}')" ng-show="modFact">Modificar</button>
								</div>
							</div>
						</div>
						{% endif %}
						{% if consultaFacturacion == 'SI' %}
						<div class="panel panel-info">
							<div class="panel-heading">
								<strong>Histórico facturación</strong>
							</div>
							<!-- /.panel-heading -->

							<div class="panel-body" style="max-height: 308px ;overflow-y: scroll;">
								<div class="table-responsive">

									<table id="expedientesTabla" class="table table-striped table-bordered table-hover">
										
										<thead>
											<tr>
												<th width="30px"></th>
												<th>Fecha de Facturación</th>
												<th>Concepto</th>
												<th>Importe</th>
												<th width="30px"></th>
											</tr>
										</thead>
										<tbody>
											<tr ng-repeat ="factura in facturas| orderBy:'f_fact'">
												<td><a href="" ng-click="modificaFactura(factura.id)"><i class="fa fa-edit text-info"></i></a></td>
												<td>[[factura.f_fact | date: 'dd/MM/yyyy']]</a></td>
												<td>[[factura.concepto]]</td>
												<td>[[factura.importe]] €</td>
												<td><a href="" ng-click="eliminarFactura(factura.id)"><i class="fa fa-trash-o text-danger"></i></a></td>
											</tr>
										</tbody>
									</table>
									

								</div>

							</div>
						</div>
						{% endif %}
						
						
					</div>
				</div>
			</div>
			
		</div>

	</section>	
</div>
{% endblock %}



